<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">
	
	<grid name="module-builder-grid" title="Module builder" model="com.axelor.studio.db.ModuleBuilder">
		<toolbar>
			<button name="restartServer" title="Restart server" showIf="typeSelect == 2" onClick="action-module-builder-validate-restart-server,action-module-builder-method-restart-server"/>
		</toolbar>
      <field name="name" />
  	</grid>
  	
  	<form name="module-builder-form" title="Module builder" model="com.axelor.studio.db.ModuleBuilder" onNew="action-module-builder-record-on-onnew">
  		<toolbar>
			<button name="restartServer" title="Restart server" showIf="typeSelect == 2" onClick="action-module-builder-validate-restart-server,action-module-builder-method-restart-server"/>
		</toolbar>
  		<panel>
      		<field name="name" pattern="axelor(-[a-z]+)+$" />
      		<field name="fileTypeSelect"/>
      		<field name="typeSelect" hidden="true"/>
      	</panel>
   		<panel name="exportPanel" colSpan="12" showIf="typeSelect == 1">
 			<field name="exportMetaFile" widget="binary-link" readonly="true"/>
 			<button name="exportModule" title="Export module" onClick="save,action-module-builder-method-export-module,save" showIf="fileTypeSelect"/>
		</panel>
		<panel name="importPanel" colSpan="12" showIf="typeSelect == 2">
 			<field name="importMetaFile" widget="binary-link" onChange="action-module-builder-record-meta-file-change"/>
			<field name="generatedFile" widget="binary-link" showIf="importMetaFile != null"/>
 			<button name="importModule" title="Import module" onClick="save,action-module-builder-method-import-module,save" showIf="importMetaFile != null"/>
	 	</panel>
  	</form>
  	
  	<action-method name="action-module-builder-method-export-module">
  		<call class="com.axelor.studio.web.ModuleBuilderController" method="exportModule"/>
  	</action-method>
  	
  	<action-method name="action-module-builder-method-import-module">
  		<call class="com.axelor.studio.web.ModuleBuilderController" method="importModule"/>
  	</action-method>
  	
  	<action-method name="action-module-builder-method-restart-server">
  		<call class="com.axelor.studio.web.ModuleBuilderController" method="restartServer"/>
  	</action-method>
  	
  	<action-validate name="action-module-builder-validate-restart-server">
  		<alert message="Are you sure wants to restart the server?"/>
  	</action-validate>
	
	<action-record name="action-module-builder-record-meta-file-change" model="com.axelor.studio.db.ModuleBuilder">
		<field name="name" expr="eval: importMetaFile.fileName.replace('.zip','')" if="importMetaFile != null &amp;&amp; importMetaFile.fileName.endsWith('.zip')"/>
	</action-record>
	
	<action-record name="action-module-builder-record-on-onnew" model="com.axelor.studio.db.ModuleBuilder">
		<field name="typeSelect" expr="eval: _typeSelect"/>
	</action-record>
	
</object-views>
