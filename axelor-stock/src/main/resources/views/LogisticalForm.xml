<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

    <grid model="com.axelor.apps.stock.db.LogisticalForm" title="Logistical forms" name="logistical-form-grid">
        <field name="deliveryNumber" />
        <field name="company" />
        <field name="deliverToCustomer" />
        <field name="collectionDate" />
        <field name="statusSelect" />
    </grid>

    <form model="com.axelor.apps.stock.db.LogisticalForm" title="Logistical form" name="logistical-form-form"
        width="large" onNew="action-logistical-form-new" onSave="action-logistical-form-check-lines">
        <toolbar>
            <button name="carrierValidatedBtn" title="Carrier validated" showIf="statusSelect == 1" readonlyIf="!logisticalFormLineList.length"
                onClick="action-logistical-form-change-status" />
            <button name="collectedBtn" title="Collected" showIf="statusSelect == 2" readonlyIf="!logisticalFormLineList.length"
                onClick="action-logistical-form-change-status" />
            <button name="packagingListBtn" title="Print packaging list" showIf="statusSelect > 1" readonlyIf="!logisticalFormLineList.length"
                onClick="action-logistical-form-print-packaging-list" icon="fa-print" if-module="axelor-supplychain" />
        </toolbar>
        <panel colSpan="12" readonlyIf="statusSelect > 1">
            <field name="deliveryNumber" />
            <field name="company" onChange="action-logistical-form-company-change" />
            <field name="deliverToCustomer" domain="self.isCustomer = TRUE AND :company MEMBER OF self.companySet"
                onChange="action-logistical-form-partner-change" />
            <field name="collectionDate" />
        </panel>
        <panel-tabs colSpan="12" readonlyIf="statusSelect > 1">
            <panel title="General">
                <field name="statusSelect" colSpan="12" widget="NavSelect" />
                <field name="carrier" domain="self.isCarrier = TRUE" />
                <field name="forwarder" />
                <field name="incoterm" />
                <field name="tracking" />
                <field name="totalGrossWeight" colSpan="4" />
                <field name="totalNetWeight" colSpan="4" />
                <field name="totalVolume" colSpan="4" />
                <field name="internalDeliveryComment" />
                <field name="externalDeliveryComment" />
            </panel>
            <panel title="Lines">
                <panel colSpan="12">
                    <field name="stockMove" title="Stock move" type="reference" widget="many-to-one"
                        target="com.axelor.apps.stock.db.StockMove" grid-view="stock-move-out-grid" form-view="stock-move-form"
                        colSpan="10" onSelect="action-logistical-form-stock-move-domain" />
                    <button name="addStockMoveBtn" title="Add" onClick="action-logistical-form-add-stock-move"
                        colSpan="2" readonlyIf="!stockMove" />
                </panel>
                <panel-related field="logisticalFormLineList" grid-view="logistical-form-line-grid"
                    form-view="logistical-form-line-form" colSpan="12" canMove="true" orderBy="sequence" editable="true"
                    onChange="action-logistical-form-lines-change" />
                <panel colSpan="12" hideIf="$readonly()">
                    <button name="addParcelBtn" title="Add parcel" onClick="action-logistical-form-add-parcel"
                        colSpan="2" colOffset="8" />
                    <button name="addPalletBtn" title="Add pallet" onClick="action-logistical-form-add-pallet"
                        colSpan="2" />
                </panel>
            </panel>
        </panel-tabs>
    </form>

    <action-record name="action-logistical-form-new" model="com.axelor.apps.stock.db.LogisticalForm">
        <field name="company" expr="eval: __user__.activeCompany" />
        <field name="collectionDate" expr="eval: __date__" />
    </action-record>

    <action-group name="action-logistical-form-change-status">
        <action name="save" />
        <action name="action-logistical-form-record-change-status" />
        <action name="save" />
    </action-group>

    <action-record name="action-logistical-form-company-change" model="com.axelor.apps.stock.db.LogisticalForm">
        <field name="deliverToCustomer" expr="eval: null" />
        <field name="logisticalFormLineList" expr="eval: null" />
    </action-record>

    <action-record name="action-logistical-form-partner-change" model="com.axelor.apps.stock.db.LogisticalForm">
        <field name="logisticalFormLineList" expr="eval: null" />
    </action-record>

    <action-record name="action-logistical-form-record-change-status" model="com.axelor.apps.stock.db.LogisticalForm">
        <field name="statusSelect" expr="eval: ++statusSelect" />
    </action-record>

    <action-method name="action-logistical-form-method-generate-delivery-number">
        <call class="com.axelor.apps.stock.web.LogisticalFormController" method="generateDeliveryNumber" />
    </action-method>

    <action-group name="action-logistical-form-add-stock-move">
        <action name="action-logistical-form-method-add-stock-move" />
        <action name="action-logistical-form-lines-change" />
        <action name="save" />
    </action-group>

    <action-method name="action-logistical-form-method-add-stock-move">
        <call class="com.axelor.apps.stock.web.LogisticalFormController" method="addStockMove" />
    </action-method>

    <action-method name="action-logistical-form-lines-change">
        <call class="com.axelor.apps.stock.web.LogisticalFormController" method="compute" />
    </action-method>

    <action-group name="action-logistical-form-add-parcel">
        <action name="action-logistical-form-method-add-parcel" />
        <action name="save" />
    </action-group>

    <action-method name="action-logistical-form-method-add-parcel">
        <call class="com.axelor.apps.stock.web.LogisticalFormController" method="addParcel" />
    </action-method>

    <action-group name="action-logistical-form-add-pallet">
        <action name="action-logistical-form-method-add-pallet" />
        <action name="save" />
    </action-group>

    <action-method name="action-logistical-form-method-add-pallet">
        <call class="com.axelor.apps.stock.web.LogisticalFormController" method="addPallet" />
    </action-method>

    <action-method name="action-logistical-form-check-lines">
        <call class="com.axelor.apps.stock.web.LogisticalFormController" method="checkLines" />
    </action-method>

    <action-method name="action-logistical-form-stock-move-domain">
        <call class="com.axelor.apps.stock.web.LogisticalFormController" method="setStockMoveDomain" />
    </action-method>

</object-views>
