(this["webpackJsonpgeneric-builder"]=this["webpackJsonpgeneric-builder"]||[]).push([[0],{166:function(e,t,n){},167:function(e,t,n){"use strict";n.r(t);var a,o=n(0),l=n.n(o),c=n(17),r=n.n(c),i=n(14),u=n(10),s=n.n(u),d=n(18),m=n(28),f=n(62),p=n(7),j=n(42),b=n(171),v=n(178),h=n(228),O=n(173),g=n(229),y=n(174),x=n(221),N=n(222),_=n(223),C=n(224),w=n(225),M=n(226),V=n(227),F=n(83),k=n.n(F),L=n(82),T=n.n(L),R=n(50),I=n(108),S=n(49),E=n.n(S),A=n(27),B=n(34),P=n.n(B),$=n(239),D=n(220),J=n(232),Y=n(172),z=n(217),G=n(218),q=n(219),K=n(116),H=n(117),U={};var W=new(function(){function e(){Object(K.a)(this,e);var t=new Headers;t.append("Accept","application/json"),t.append("Content-Type","application/json"),t.append("X-Requested-With","XMLHttpRequest"),t.append("X-CSRF-Token",function(e){var t=document.cookie||"";return t!==a&&(a=t,U=t.split("; ").reduce((function(e,t){var n=t.split("=");return e[n[0]]=n[1],e}),{})),U[e]}("CSRF-TOKEN")),this.baseURL="..",this.headers=t}return Object(H.a)(e,[{key:"fetch",value:function(e){function t(t,n,a){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t,n){return fetch(e,n).then((function(e){return-1!==["head","delete"].indexOf(t.toLowerCase())?e:e.headers.get("content-type").includes("application/json")?e.json():e})).catch((function(e){}))}))},{key:"request",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=Object.assign({method:"POST",credentials:"include",headers:this.headers,mode:"cors",body:JSON.stringify(n)},t);return"GET"===t.method&&delete a.body,this.fetch("".concat(this.baseURL).concat(0===e.indexOf("/")?e:"/".concat(e)),t.method,a)}},{key:"get",value:function(e){return this.request(e,{method:"GET"})}},{key:"post",value:function(e,t){return this.request(e,{method:"POST"},t)}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(p.a)({offset:0},t),a="ws/rest/".concat(e,"/search");return this.post(a,n)}},{key:"fields",value:function(e){return this.post("/ws/meta/view/fields",e)}},{key:"fetchRecord",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a="ws/rest/".concat(e,"/").concat(t,"/fetch");return this.post(a,n)}},{key:"add",value:function(e,t){var n={data:t},a="ws/rest/".concat(e);return this.post(a,n)}}]),e}());function X(e){return"bpmQuery"===e}function Q(e){if(e)return e.charAt(0).toLowerCase()+e.slice(1)}function Z(e){return e?{_domain:e}:null}var ee=function(e,t,n){var a=e.type,o=e.jsonField;switch(a){case"text":case"string":case"date":case"datetime":case"time":return"json_extract_text(".concat(t,".").concat(o,",'").concat(n,"')");case"many-to-one":case"json-many-to-one":case"many_to_one":case"json_many_to_one":return"json_extract_integer(".concat(t,".").concat(o,",").concat(e.name,",'id')");case"integer":return"json_extract_integer(".concat(t,".").concat(o,",'").concat(n,"')");case"decimal":return"json_extract_decimal(".concat(t,".").concat(o,",'").concat(n,"')");case"boolean":return"json_extract_boolean(".concat(t,".").concat(o,",'").concat(n,"')")}};function te(e){return window._t&&"string"===typeof e?window._t(e):e}function ne(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return e.sort((function(e,n){var a=e[t],o=n[t];return a<o?-1:a>o?1:0}))}function ae(e,t){return(""+e).replace(/["'\\\n\r\u2028\u2029]/g,(function(n){switch(n){case'"':case"\\":return"\\"+n;case"'":return t?"\\"+n:'"';case"\n":return"\\n";case"\r":return"\\r";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return e}}))}var oe=[{name:"and",title:"AND"},{name:"or",title:"OR"}],le={and:"&&",or:"||"},ce={and:"and",or:"or"},re={JS:".",GROOVY:"?.",BPM:"."},ie={date:"DD/MM/YYYY",time:"HH:mm:ss",datetime:"DD/MM/YYYY HH:mm"},ue=["=",">=","<=",">","<","like","isNull","between","contains","in","isTrue"],se=["many_to_many","many-to-many","json_many_to_many","json-many-to-many","one_to_one","one-to-one","json_one_to_one","json-one-to-one","enum"],de=["long","decimal","date","time","datetime","enum","text","integer","boolean","many_to_many","many-to-many","json_many_to_many","json-many-to-many","many_to_one","many-to-one","json_many_to_one","json-many-to-one","one_to_one","one-to-one","json_one_to_one","json-one-to-one","string"],me={enum:["=","!=","isNull","isNotNull"],text:["like","notLike","isNull","isNotNull"],integer:["=","!=",">=","<=",">","<","between","notBetween","isNull","isNotNull"],boolean:["isTrue","isFalse"]},fe={JS:{"=":"===","!=":"!==",">":">",">=":">=","<":"<","<=":"<=",in:"in",notIn:"in",like:"LIKE",notLike:"NOT LIKE",isNotNull:"!== null",isNull:"=== null",isTrue:"===",isFalse:"==="},GROOVY:{"=":"==","!=":"!=",">":">",">=":">=","<":"<","<=":"<=",isNotNull:"!= null",isNull:"== null",isTrue:"==",isFalse:"==",in:"contains",notIn:"contains",like:"contains",notLike:"contains",contains:"contains",notContains:"contains"},BPM:{"=":"=","!=":"!=",">":">",">=":">=","<":"<","<=":"<=",isNotNull:"is NOT NULL",isNull:"is NULL",isTrue:"is",isFalse:"is",in:"IN",notIn:"NOT IN",like:"LIKE",notLike:"NOT LIKE",contains:"MEMBER OF",notContains:"NOT MEMBER OF"}},pe=["many-to-one","json-many-to-one","many_to_one","json_many_to_one"],je=[{name:"=",title:"equals"},{name:"!=",title:"not equal"},{name:">",title:"greater than"},{name:">=",title:"greater or equal"},{name:"<",title:"less than"},{name:"<=",title:"less or equal"},{name:"in",title:"in"},{name:"between",title:"between"},{name:"notBetween",title:"not Between"},{name:"notIn",title:"not in"},{name:"isNull",title:"is null"},{name:"isNotNull",title:"is not null"},{name:"like",title:"contains"},{name:"notLike",title:"doesn't contain"},{name:"isTrue",title:"is true"},{name:"isFalse",title:"is false"},{name:"contains",title:"contains"},{name:"notContains",title:"not contains"}],be=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=e&&e.data,l=o&&o.fields,c=Object.values(o&&o.jsonFields||[{}]),r=[];return r=l&&l.filter((function(e){return!e.json&&de.includes((e.type||"").toLowerCase())}))||[],!t||a||c&&c.forEach((function(e){var o=(Object.values(e||{})||[]).filter((function(e){return de.includes((e.type||"").toLowerCase())&&("many-to-many"!==e.type||e.targetName)}))||[];t&&!a&&(o=o.filter((function(e){return![].concat(Object(m.a)(se),Object(m.a)(n?["many_to_one","json_many_to_one","many-to-one","json-many-to-one"]:[])).includes((e.type||"").toLowerCase())}))||[]),r=[].concat(Object(m.a)(r),Object(m.a)(o))})),r};function ve(e,t){return he.apply(this,arguments)}function he(){return(he=Object(d.a)(s.a.mark((function e(t,n){var a,o,l,c,r,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",[]);case 2:if("metaModel"!==t.type){e.next=17;break}return e.next=5,W.get("ws/meta/fields/".concat(t.fullName?t.fullName:"".concat(t.packageName,".").concat(t.name)));case 5:return a=e.sent,o=be(a,n),e.next=9,W.search("com.axelor.meta.db.MetaField",{data:{_domain:"self.metaModel.name = '".concat(t.name,"' AND self.typeName = 'ZonedDateTime'"),_domainContext:{_model:"com.axelor.meta.db.MetaField"}},fields:["name","typeName","metaModel"]});case 9:if(l=e.sent,!((c=l&&l.data&&l.data.length>0&&l.data.map((function(e){return e.name})))&&c.length>0&&o&&o.length>0)){e.next=14;break}return o.forEach((function(e){c.includes(e.name)&&(e.typeName="ZonedDateTime")})),e.abrupt("return",o);case 14:return e.abrupt("return",o);case 17:return e.next=19,W.get("ws/meta/fields/com.axelor.meta.db.MetaJsonRecord?jsonModel=".concat(t.name));case 19:return r=e.sent,i=be(r,n),e.abrupt("return",ne(i,"sequence")||[]);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(e){return ge.apply(this,arguments)}function ge(){return(ge=Object(d.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W.search("com.axelor.meta.db.MetaModel",t);case 2:return n=e.sent,e.abrupt("return",n&&n.data&&n.data[0]);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(){return(ye=Object(d.a)(s.a.mark((function e(t){var n,a,o,l,c,r,i,u,d,m,f,p,j=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(j.length>1&&void 0!==j[1])||j[1],a=j.length>2&&void 0!==j[2]&&j[2],o=j.length>3?j[3]:void 0,l=j.length>4&&void 0!==j[4]&&j[4],c=j.length>5?j[5]:void 0,"com.axelor.meta.db.MetaJsonRecord"!==t||!o){e.next=16;break}return e.next=8,W.get("ws/meta/fields/com.axelor.meta.db.MetaJsonRecord?jsonModel=".concat(o));case 8:if(r=e.sent,i=(i=be(r,a,l,c)||[]).filter((function(e){return de.includes((e.type||"").toLowerCase())&&(!a||!e.json)&&("many-to-many"!==(e.type||"").toLowerCase()||e.targetName)})),!(!n&&i&&i.length>0)){e.next=13;break}return e.abrupt("return",i.filter((function(e){return!["many_to_many","json_many_to_many"].includes((e&&(e.type||"")).toLowerCase().replaceAll("-","_"))})));case 13:return e.abrupt("return",ne(i,"sequence")||[]);case 16:return u={criteria:[{fieldName:"fullName",operator:"=",value:t}]},e.next=19,Oe({data:u});case 19:if(d=e.sent){e.next=22;break}return e.abrupt("return",[]);case 22:return m=d&&d.metaFields.map((function(e){return e.name})),e.next=25,W.fields({fields:m,model:d.fullName});case 25:if(f=e.sent,p=(p=f&&f.data&&f.data.fields).filter((function(e){return de.includes((e.type||"").toLowerCase())&&(!a||!e.json)&&("many-to-many"!==e.type||e.targetName)})),!(!n&&p&&p.length>0)){e.next=30;break}return e.abrupt("return",p.filter((function(e){return!["many_to_many","json_many_to_many"].includes((e&&(e.type||"")).toLowerCase().replaceAll("-","_"))})));case 30:return e.abrupt("return",p);case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(e){return Ne.apply(this,arguments)}function Ne(){return(Ne=Object(d.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W.search(t);case 2:if(!(n=e.sent)||-1!==n.status){e.next=5;break}return e.abrupt("return",[]);case 5:return e.abrupt("return",n&&n.data);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _e(e){return Ce.apply(this,arguments)}function Ce(){return(Ce=Object(d.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W.search("com.axelor.meta.db.MetaJsonRecord",{data:{criteria:[{fieldName:"jsonModel",operator:"=",value:t}],operator:"and"}});case 2:if(!(n=e.sent)||-1!==n.status){e.next=5;break}return e.abrupt("return",[]);case 5:return e.abrupt("return",n&&n.data);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function we(e){return Me.apply(this,arguments)}function Me(){return(Me=Object(d.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W.search("com.axelor.meta.db.MetaJsonField",{data:{criteria:[{fieldName:"jsonModel",operator:"=",value:t},{fieldName:"nameField",operator:"=",value:!0}],operator:"and"},fields:["name"]});case 2:if(!((n=e.sent)&&n.status>-1)){e.next=5;break}return e.abrupt("return",n.data&&n.data[0]);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ve(){return Fe.apply(this,arguments)}function Fe(){return(Fe=Object(d.a)(s.a.mark((function e(){var t,n,a,o,l,c,r,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},n=i.length>1?i[1]:void 0,e.t1=!n||"metaModel"===n,!e.t1){e.next=7;break}return e.next=6,ke(t);case 6:e.t1=e.sent;case 7:if(e.t0=e.t1,e.t0){e.next=10;break}e.t0=[];case 10:if(a=e.t0,e.t3=!n||"metaJsonModel"===n,!e.t3){e.next=16;break}return e.next=15,Te(t);case 15:e.t3=e.sent;case 16:if(e.t2=e.t3,e.t2){e.next=19;break}e.t2=[];case 19:for(o=e.t2,l=[],c=0;c<a.length;c++)l.push(Object(p.a)(Object(p.a)({},a[c]),{},{type:"metaModel"}));for(r=0;r<o.length;r++)l.push(Object(p.a)(Object(p.a)({},o[r]),{},{type:"metaJsonModel"}));return e.abrupt("return",l||[]);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ke(){return Le.apply(this,arguments)}function Le(){return(Le=Object(d.a)(s.a.mark((function e(){var t,n,a,o,l=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:{},e.next=3,W.search("com.axelor.meta.db.MetaModel",{data:t});case 3:if(!(n=e.sent)||-1!==n.status){e.next=6;break}return e.abrupt("return",[]);case 6:return a=(n||{}).data,o=void 0===a?[]:a,e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Te(){return Re.apply(this,arguments)}function Re(){return(Re=Object(d.a)(s.a.mark((function e(){var t,n,a,o,l=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:{},e.next=3,W.search("com.axelor.meta.db.MetaJsonModel",{data:t});case 3:if(!(n=e.sent)||-1!==n.status){e.next=6;break}return e.abrupt("return",[]);case 6:return a=(n||{}).data,o=void 0===a?[]:a,e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ie(e,t,n){return Se.apply(this,arguments)}function Se(){return(Se=Object(d.a)(s.a.mark((function e(t,n,a){var o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W.fetchRecord(t,n,a);case 2:if(!(o=e.sent)||-1!==o.status){e.next=5;break}return e.abrupt("return",[]);case 5:return e.abrupt("return",o&&o.data&&o.data[0]);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ee(){return(Ee=Object(d.a)(s.a.mark((function e(t,n){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W.add(t,n);case 2:if(!(a=e.sent)||-1!==a.status){e.next=5;break}return e.abrupt("return",[]);case 5:return e.abrupt("return",a&&a.data&&a.data[0]);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ae=n(236),Be=n(210),Pe=n(234),$e=n(231),De=n(4),Je=Object(j.a)((function(e){return{root:{display:"flex",flexWrap:"wrap"},select:{width:"150px"}}}));function Ye(e){var t=e.name,n=e.value,a=void 0===n?"":n,o=e.onChange,l=e.options,c=e.title,r=e.className,i=e.disableUnderline,u=void 0!==i&&i,s=Object(A.a)(e,["name","value","onChange","options","title","className","disableUnderline"]),d=Je();return Object(De.jsxs)(Be.a,{className:P()(d.formControl,r),children:[Object(De.jsx)(Pe.a,{children:c}),Object(De.jsx)($e.a,Object(p.a)(Object(p.a)({disableUnderline:u,value:a,onChange:function(e){return o(e.target.value)},name:t,style:{marginRight:8},classes:{select:P()(d.select,r)}},s),{},{children:l&&Array.isArray(l)&&l.map((function(e,t){var n=e.name,a=e.title;return Object(De.jsx)(Ae.a,{value:n,children:a},t)}))}))]})}var ze=n(212),Ge=n(237);function qe(e){var t=e.name,n=e.title,a=e.autoTitle,o=e.value,l=void 0===o?"":o,c=e.onChange,r=e.onBlur,i=e.readOnly,u=e.inline,s=e.InputProps,d=e.style,m=Object(A.a)(e,["name","title","autoTitle","value","onChange","onBlur","readOnly","inline","InputProps","style"]);return u?Object(De.jsx)(ze.a,Object(p.a)({style:Object(p.a)({width:"100%"},d),placeholder:n,inputProps:{"aria-label":n},name:t,onChange:function(e){return c(e.target.value)},onBlur:r,autoComplete:"off",readOnly:i,disabled:i,value:l||""},m)):Object(De.jsx)(Ge.a,Object(p.a)({id:"filled-".concat(t),label:n||a,name:t,style:Object(p.a)({width:"100%"},d),onChange:function(e){return c(e.target.value)},onBlur:r,autoComplete:"off",InputProps:Object(p.a)({readOnly:i},s),value:l||"",className:m.className},m))}qe.defaultProps={rows:3,readOnly:!1};var Ke=qe,He=n(94),Ue=Object(j.a)((function(e){return{button:{textTransform:"none",color:"#0275d8"},buttonLabel:{maxHeight:30}}}));var We=function(e){var t=e.title,n=e.Icon,a=e.onClick,o=e.className,l=Ue();return t?n?Object(De.jsx)(He.a,{className:P()(l.button,l.buttonLabel,o),endIcon:Object(De.jsx)(n,{}),onClick:a,children:t}):Object(De.jsx)(He.a,{className:P()(l.button,l.buttonLabel,o),onClick:a,children:t}):Object(De.jsx)(Y.a,{size:"medium",onClick:a,className:P()(l.button,o),style:{padding:"0px 12px"},children:Object(De.jsx)(n,{fontSize:"small"})})};function Xe(e){var t=e.type,n=void 0===t?"integer":t,a=e.title,c=e.onChange,r=e.value,u=void 0===r?0:r,s=(e.readOnly,e.scale),d=void 0===s?2:s,m=(e.customeFormat,e.onBlur),f=Object(A.a)(e,["type","title","onChange","value","readOnly","scale","customeFormat","onBlur"]),j=Object(o.useState)(u),b=Object(i.a)(j,2),v=b[0],h=b[1],O=Object(o.useCallback)((function(e){return Number(Number(e).toFixed("integer"===n?0:d))}),[n,d]);return l.a.useEffect((function(){h(O(u))}),[u,h,O]),Object(De.jsx)(Ke,Object(p.a)({onChange:h,title:a,type:"number",value:"".concat(v),onBlur:function(e){c(O(v)),h(O(v)),m&&m(e)}},f))}Xe.defaultProps={readOnly:!1};var Qe=Xe,Ze=n(122),et=n(214),tt=n(216),nt=n(230),at=n(20),ot={date:et.a,time:tt.a,datetime:nt.a};var lt=function(e){var t=e.inline,n=e.type,a=void 0===n?"date":n,c=Object(A.a)(e,["inline","type"]),r=Object(o.useState)(!1),u=Object(i.a)(r,2),s=u[0],d=u[1],m=l.a.useRef(),f=(c.name,c.title),j=c.format,b=(c.error,c.onChange),v=Object(A.a)(c,["name","title","format","error","onChange"]),h=ot[a];return Object(De.jsx)(at.a,{utils:Ze.a,children:Object(De.jsx)(h,Object(p.a)(Object(p.a)(Object(p.a)(Object(p.a)({autoOk:!0,open:s,ampm:!1,views:"date"===a?["date"]:"datetime"===a?["date","hours","minutes"]:"time"===a?["hours","minutes","seconds"]:["date"],onChange:function(e){m.current=e,b(e)},PopoverProps:{anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"}},disableToolbar:!0,variant:"inline"},t?{invalidDateMessage:""}:{}),{},{style:Object(p.a)({width:"100%"},t?{margin:0}:{}),label:t?"":f,format:j||ie[a]},"time"!==a?{animateYearScrolling:!1}:{}),v),{},{onKeyDown:function(e){40===e.keyCode&&d(!0)},onClose:function(){b(m.current),d(!1)},onOpen:function(){return d(!0)}}))})},ct=n(238),rt=n(215),it=n(176),ut=n(233),st=n(123),dt=n.n(st),mt=Object(it.a)((function(e){return{listbox:{maxHeight:"300px !important"},chip:{"&.MuiChip-outlined .MuiChip-deleteIconSmall":{color:"#0275d8"},border:"1px solid #0275d8",color:"#0275d8"}}}));function ft(e){var t=Object(o.useState)(!1),n=Object(i.a)(t,2),a=n[0],c=n[1],r=Object(o.useState)([]),u=Object(i.a)(r,2),m=u[0],f=u[1],j=Object(o.useState)(e.isMulti?[]:null),b=Object(i.a)(j,2),v=b[0],h=b[1],O=Object(o.useState)(""),g=Object(i.a)(O,2),y=g[0],x=g[1],N=e.name,_=e.value,C=e.onChange,w=e.options,M=e.optionLabelKey,V=void 0===M?"title":M,F=e.optionValueKey,k=void 0===F?"id":F,L=e.isMulti,T=void 0!==L&&L,R=e.title,I=e.fetchAPI,S=e.inline,E=e.InputProps,B=e.error,P=e.filterSelectedOptions,$=void 0!==P&&P,D=e.disableCloseOnSelect,J=void 0===D||D,Y=e.readOnly,z=void 0!==Y&&Y,G=Object(A.a)(e,["name","value","onChange","options","optionLabelKey","optionValueKey","isMulti","title","fetchAPI","inline","InputProps","error","filterSelectedOptions","disableCloseOnSelect","readOnly"]),q=mt(),K=Object(o.useState)(!1),H=Object(i.a)(K,2),U=H[0],W=H[1],X=l.a.useCallback((function(e){return w&&w.find((function(t){return t&&t[k]===e.trim()}))}),[w,k]);function Q(){return(Q=Object(d.a)(s.a.mark((function e(){var t,n=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.length>0&&void 0!==n[0]?n[0]:"",x(t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=function(e,t){var n=l.a.useRef(null),a=function(){return n.current&&clearTimeout(n.current)},o=function(e){return n.current=setTimeout(e,t)};return l.a.useEffect((function(){return function(){return a()}}),[]),function(){for(var t=arguments.length,n=new Array(t),l=0;l<t;l++)n[l]=arguments[l];a(),o((function(){return e.apply(void 0,n)}))}}((function(){return Q.apply(this,arguments)}),400);function ee(e){"Backspace"===e.key&&v&&v[V]===y&&C(null)}function ne(e){C("string"===typeof _?T?e.map((function(e){return e&&e[k]})).join(",")||[]:e&&e[k]:e)}Object(o.useEffect)((function(){var e=!0;return a&&(W(!0),I?Object(d.a)(s.a.mark((function t(){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,I({search:y});case 2:n=t.sent,e&&(f(n),W(!1));case 4:case"end":return t.stop()}}),t)})))():(f(w),W(!1))),function(){e=!1,W(!1)}}),[I,w,y,a]),Object(o.useEffect)((function(){if("string"===typeof _){var e=_.split(",");h(T?e.map((function(e){return X(e)})):X(e[0]))}else h(_||(T?[]:null))}),[_,T,X]);var ae=function(e){return"metaJsonModel"===(e&&e.type)?"".concat(e&&e[V]?e[V]:""," (Custom model)")||!1:"fieldName"===N?"".concat(te(e&&e.title?e.title:"")," (").concat(e&&e[V],")"):e?e[V]?e[V]:e.id?e.id.toString():"":""};return Object(De.jsx)(ut.a,Object(p.a)(Object(p.a)({getOptionSelected:function(e,t){return T?e[k]===t[k]:ae(e)===ae(t)},getOptionLabel:function(e){return ae(e)},loading:U,id:dt()("select-widget"),open:a,onOpen:function(){return c(!0)},onClose:function(){return c(!1)},disabled:z,value:v?T?Array.isArray(v)?v:[]:v:T?[]:null,renderTags:function(e,t){return e.map((function(e,n){return Object(De.jsx)(ct.a,Object(p.a)({variant:"outlined",label:e[V],size:"small",classes:{root:q.chip}},t({index:n})))}))},onChange:function(e,t){return ne(t)},options:m||[],multiple:T,filterSelectedOptions:$,onInputChange:function(e,t){return Z(t)},classes:{option:"menu-item",listbox:q.listbox},renderInput:function(e){return Object(De.jsx)(Ge.a,Object(p.a)(Object(p.a)({},e),{},{error:B,label:S?"":R,fullWidth:!0,onClick:function(){z||c(!0)},InputProps:Object(p.a)(Object(p.a)(Object(p.a)({},E),e.InputProps),{},{endAdornment:Object(De.jsxs)(l.a.Fragment,{children:[U?Object(De.jsx)(rt.a,{className:q.circularProgress,size:15}):null,e.InputProps.endAdornment]})})},T?{}:{onKeyDown:ee}))}},T?{disableCloseOnSelect:J}:{}),G))}var pt=Object(j.a)((function(){return{MuiAutocompleteRoot:{width:"250px",marginRight:"10px"},iconButton:{marginRight:10},icon:{color:"#0275d8"}}}));function jt(e){var t=e.initValue,n=void 0===t?"":t,a=e.getMetaFields,c=e.editor,r=e.onChange,u=e.value,f=e.classNames,j=e.expression,b=void 0===j?"GROOVY":j,v=e.type,h=e.isParent,O=void 0!==h&&h,g=e.isBPM,y=e.isField,x=e.setInitialField,N=void 0===x?function(){}:x,_=u||{},C=_.fieldName,w=void 0===C?"":C,M=_.allField,V=void 0===M?[]:M,F=Object(o.useState)([]),k=Object(i.a)(F,2),L=k[0],T=k[1],R=pt(),I="context"===y&&X(v)&&g,S=X(v)?"BPM":b,E=Object(o.useState)(null),A=Object(i.a)(E,2),B=A[0],$=A[1],D=Object(o.useState)(null),J=Object(i.a)(D,2),K=J[0],H=J[1],U=B||[],W=Object(i.a)(U,1)[0],Q=w&&O&&L&&L.some((function(e){return e.name===W})),Z=Q&&(L.find((function(e){return e.name===W}))||{}).target,ee=Q&&(L.find((function(e){return e.name===W}))||{}).jsonTarget,ne=(L.find((function(e){return e.name===W}))||{}).type,ae=V&&V.length>0&&V.find((function(e){return["many_to_many","json_many_to_many"].includes((e&&(e.type||"")).toLowerCase().replaceAll("-","_"))})),oe=V&&V.length>0&&V.find((function(e){return["many_to_one","json_many_to_one"].includes((e&&(e.type||"")).toLowerCase().replaceAll("-","_"))})),le=["one_to_one","json_one_to_one"].includes((ne||"").toLowerCase().replaceAll("-","_"));function ce(e){var t=e&&L.some((function(t){return t.name===e.name&&t.target}));if(g){var a,o=O?e&&e.name?"".concat(n).concat(e.name):"".concat(function(){var e=n&&n.split(re[S]);return e&&e.length>0&&(e.filter(Boolean)||[]).join(re[S])}()):e&&e.name?"".concat(t?I?"?.":re[S]:"").concat(n).concat(e.name):"";if(e&&V.findIndex((function(t){return t.name===e.name}))<=-1){var l=(o||"").split(I?"?.":re[S])||[],i=V&&V.filter((function(e){return l.includes(e.name)}))||[];a=[].concat(Object(m.a)(i),[e])}else{var u=Object(m.a)(V||[]),s=(w||"").split(I?"?.":re[S]);s&&s.length>0&&s.forEach((function(e){var t=u.findIndex((function(t){return t.name===e}));t>-1&&u.splice(t,1)})),a=u}r({name:"fieldName",value:e,fieldNameValue:o||void 0,allField:a,isShow:K},c)}else{var d=O?"".concat(n).concat(e?e.name:""):e?e.name:"";if(d=X(v)?e&&e.name?d:d.slice(0,-1):d,r({name:"fieldName",value:d},c),r({name:"fieldType",value:e&&e.type||""},c),r({name:"field",value:e},c),r({name:"isShow",value:K},c),e&&V.findIndex((function(t){return t.name===e.name}))<=-1){var f=(d||"").split(re[S])||[],p=V&&V.filter((function(e){return f.includes(e.name)}))||[];r({name:"allField",value:[].concat(Object(m.a)(p),[e])},c)}else{var j=Object(m.a)(V||[]),b=(w||"").split(re[S]),h="".concat(n).concat(re[S]).concat(W).split(re[S]);if(b&&b.length>0&&b.forEach((function(e){var t=j.findIndex((function(t){return t.name===e}));t>-1&&!(h||[]).includes(e)&&j.splice(t,1)})),r({name:"allField",value:j},c),r({name:"fieldValue",value:null},c),j&&1===j.length){var y=j[0];r({name:"fieldType",value:y&&y.type||""},c),r({name:"field",value:y},c),N()}else{var x=j[j.length-1];r({name:"fieldType",value:x&&x.type||""},c),r({name:"field",value:x},c),N()}}}}var ie=L&&L.find((function(e){return e.name===W}))||V&&V.find((function(e){return e.name===W}));return Object(o.useEffect)((function(){var e=w&&re[S]&&w.split(I?"?.":re[S]);$(e);var t=e&&e.slice(1)&&e.slice(1).join(I?"?.":re[S]);H(!(!t||["toLocalDateTime()","getTarget()"].includes(t)))}),[w,I,S]),Object(o.useEffect)((function(){var e=!0;return Object(d.a)(s.a.mark((function t(){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a();case 2:n=t.sent,e&&T(n);case 4:case"end":return t.stop()}}),t)})))(),function(){e=!1}}),[a]),Object(De.jsxs)(l.a.Fragment,{children:[Object(De.jsx)(ft,{name:"fieldName",title:"Field Name",placeholder:"field name",options:L,optionLabelKey:"name",onChange:function(e){return ce(e)},value:ie,classes:{root:P()(R.MuiAutocompleteRoot,f&&f.root)}}),Q&&Z&&Object(De.jsxs)(l.a.Fragment,{children:[K&&!le&&Object(De.jsx)(Y.a,{size:"small",onClick:function(){if(H((function(e){return!e})),V&&V.length>0&&W){var e=V.find((function(e){return e.name===W}));ce(Object(p.a)({},e||{}))}},className:R.iconButton,children:Object(De.jsx)(z.a,{title:te("Remove sub field"),children:Object(De.jsx)(G.a,{className:R.icon,fontSize:"small"})})}),(K||le)&&Object(De.jsx)(jt,{getMetaFields:function(){return function(e){return ye.apply(this,arguments)}(Z,!!X(v)||ae&&B&&B.length>0&&B.includes(ae.name)&&B[0]!==ae.name,X(v),ee,oe,g)},editor:c,initValue:"".concat(n).concat(W).concat(I?"?.":re[S]),value:{fieldName:B.slice(1).join(I?"?.":re[S]),allField:V},onChange:r,classNames:f,expression:S,type:v,isParent:!!Z,isBPM:g,setInitialField:N,isField:y}),!K&&!le&&Object(De.jsx)(Y.a,{size:"small",onClick:function(){return H((function(e){return!e}))},className:R.iconButton,children:Object(De.jsx)(z.a,{title:te("Add sub field"),children:Object(De.jsx)(q.a,{className:R.icon,fontSize:"small"})})})]})]})}var bt=n(51),vt=Object(j.a)((function(e){return{Container:{display:"flex"},rulesGroupHeader:{display:"flex"},paper:{margin:e.spacing(1,0),padding:e.spacing(3,2),overflow:"auto"},rules:{display:"flex",alignItems:"flex-end",justifyContent:"flex-start",marginBottom:15},MuiAutocompleteRoot:{width:"250px",marginRight:"10px"},disabled:{pointerEvents:"none",opacity:.5},valueFrom:{fontSize:12,color:"rgba(0, 0, 0, 0.54)",fontFamily:'"Roboto", "Helvetica", "Arial", sans-serif'},radio:{padding:"1px 9px",color:"#0275d8","&.MuiRadio-colorSecondary.Mui-checked":{color:"#0275d8"}},operators:{minWidth:75},iconButton:{marginRight:10},timelineConnector:{backgroundColor:"#0275d8"},combinator:{width:"fit-content"},icon:{color:"#0275d8"},timelineOppositeContent:{display:"flex",alignItems:"center",justifyContent:"flex-end",padding:0,maxWidth:"8%"}}}));function ht(e,t){return Ot.apply(this,arguments)}function Ot(){return(Ot=Object(d.a)(s.a.mark((function e(t,n){var a,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=X(n),e.next=3,ve(t,a);case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0=[];case 6:return o=e.t0,e.abrupt("return",o.filter((function(e){return de.includes((e.type||"").toLowerCase())&&(!a||!e.json)})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gt(e){var t=e.operator,n=e.editor,a=e.internalProps,l=e.parentType,c=a.onChange,r=a.value,u=Object(A.a)(a,["onChange","value"]),m=vt(),f=u.field,j=void 0===f?{}:f,b=j.targetName,v=j.target,h=j.targetModel,O=j.model,g=j.jsonTarget,y=Object(o.useState)(null),x=Object(i.a)(y,2),N=x[0],_=x[1],C=function(){var e=Object(d.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("com.axelor.meta.db.MetaJsonRecord"!==O||!g){e.next=10;break}return e.next=3,_e(g);case 3:return t=e.sent,e.next=6,we(g);case 6:n=e.sent,_(n&&n.name),e.next=13;break;case 10:return e.next=12,xe(v||h);case 12:t=e.sent;case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return["like","notLike"].includes(t)?Object(De.jsx)(Ke,Object(p.a)({name:"fieldValue",onChange:function(e){var t;"string"===typeof e||X(l)||(t=e&&e.length>0?e.find((function(e){return e[b]})):e[b],c({name:"nameField",value:t?N:"id"},n)),c({name:"fieldValue",value:e},n)},margin:"none",style:{marginTop:"15px",width:"250px !important"},value:r},u)):["contains","notContains","in","notIn","=","!="].includes(t)?Object(De.jsx)(ft,{name:"fieldValue",title:"Value",placeholder:"Value",fetchAPI:C,isMulti:!(X(l)&&["contains","notContains"].includes(t)||["=","!="].includes(t)),optionLabelKey:b,onChange:function(e){var t;"string"===typeof e||X(l)||(t=e&&e.length>0?e.find((function(e){return e[b]})):e[b],c({name:"nameField",value:t?N:"id"},n)),c({name:"fieldValue",value:e},n)},value:r||[],classes:{root:m.MuiAutocompleteRoot}}):null}function yt(e){var t=e.Component,n=e.operator,a=e.editor,o=e.internalProps,c=o.onChange,r=o.value,i=o.value2,u=o.classes,s=o.style,d=o.targetName,m=Object(A.a)(o,["onChange","value","value2","classes","style","targetName"]);return["=","!=",">",">=","<","<=","like","notLike"].includes(n)?Object(De.jsx)(t,Object(p.a)({name:"fieldValue",onChange:function(e){return c({name:"fieldValue",value:e},a)},value:r,style:s},m)):["between","notBetween"].includes(n)?Object(De.jsxs)(l.a.Fragment,{children:[Object(De.jsx)(t,Object(p.a)({name:"fieldValue",style:Object(p.a)({marginRight:8},s),onChange:function(e){return c({name:"fieldValue",value:e},a)},value:r},m)),Object(De.jsx)(t,Object(p.a)({name:"fieldValue2",onChange:function(e){return c({name:"fieldValue2",value:e},a)},value:i,style:s},m))]}):["in","notIn"].includes(n)?Object(De.jsx)(ft,Object(p.a)({name:"fieldValue",title:"Value",placeholder:"Value",isMulti:!0,optionLabelKey:d,onChange:function(e){c({name:"fieldValue",value:e},a)},value:r||[],classes:{root:u.MuiAutocompleteRoot},optionValueKey:"name"},m)):null}function xt(e){var t=e.type,n=e.operator,a=e.onChange,o=e.value,l=e.classes,c=e.parentType,r=e.editor,i=Object(A.a)(e,["type","operator","onChange","value","classes","parentType","editor"]),u=Object(p.a)({value:o.fieldValue,value2:o.fieldValue2,onChange:a},i),s=[],d={};switch(t){case"one_to_one":case"many_to_one":case"many_to_many":case"one_to_many":case"json_one_to_one":case"json_many_to_one":case"json_many_to_many":case"json_one_to_many":return Object(De.jsx)(gt,{operator:n,editor:r,internalProps:Object(p.a)({},u),parentType:c});case"date":case"time":case"datetime":var m=function(e){return e?E()(e,ie[t]):null};return Object(De.jsx)(yt,{Component:lt,operator:n,editor:r,internalProps:Object(p.a)(Object(p.a)({type:t,value:m(o.fieldValue),value2:m(o.fieldValue2),onChange:function(e,n){var o=e.name,l=e.value;return a({name:o,value:l&&l.format(ie[t])},n)}},i),{},{margin:"none",classes:l,style:{marginTop:"15px",width:"250px !important"}})});case"integer":case"long":case"decimal":return d={Component:(s=i.field.selectionList&&i.field.selectionList.map((function(e){var t=e.title,n=e.value,a=e.data;return{name:a&&a.value||n,title:t}})))?Ye:Qe,operator:n,editor:r,internalProps:Object(p.a)({},s?Object(p.a)({options:s,classes:l},u):Object(p.a)(Object(p.a)({type:t},u),{},{margin:"none",classes:l,style:{marginTop:"15px",width:"250px !important"}}))},Object(De.jsx)(yt,Object(p.a)({},d));case"enum":return s=i.field.selectionList.map((function(e){var t=e.title,n=e.value,a=e.data;return{name:a&&a.value||n,title:t}})),Object(De.jsx)(yt,{Component:Ye,operator:n,editor:r,internalProps:Object(p.a)({options:s,classes:l},u)});default:return d={Component:(s=i.field&&i.field.selectionList&&i.field.selectionList.map((function(e){var t=e.title,n=e.value,a=e.data;return{name:a&&a.value||n,title:t}})))?Ye:Ke,operator:n,editor:r,internalProps:Object(p.a)({},s?Object(p.a)({options:s,classes:l},u):Object(p.a)(Object(p.a)({classes:l},u),{},{margin:"none",style:{marginTop:"15px",width:"250px !important"}}))},Object(De.jsx)(yt,Object(p.a)({},d))}}function Nt(e){var t=e.getMetaFields,n=e.onChange,a=e.onRemoveRule,c=e.editor,r=e.value,u=e.expression,s=e.parentType,d=e.parentMetaModal,m=e.element,f=r.fieldType,p=void 0===f?"":f,j=r.field,b=r.operator,v=r.fieldValue,h=r.fieldValue2,O=void 0===h?"":h,g=r.relatedValueModal,y=r.relatedValueFieldName,x=r.relatedElseValueModal,N=r.relatedElseValueFieldName,_=vt(),C=p&&p.toLowerCase().replaceAll("-","_"),w=Object(o.useState)("none"),M=Object(i.a)(w,2),V=M[0],F=M[1],k=Object(o.useState)(g||null),L=Object(i.a)(k,2),R=L[0],I=L[1],S=Object(o.useState)(!1),E=Object(i.a)(S,2),A=E[0],B=E[1],P=Object(o.useState)(null),K=Object(i.a)(P,2),H=K[0],U=K[1],W=Object(o.useState)(),ee=Object(i.a)(W,2),ne=ee[0],ae=ee[1],oe=Object(o.useState)(null),le=Object(i.a)(oe,2),ce=le[0],ie=le[1],ue=Object(o.useState)(null),se=Object(i.a)(ue,2),de=se[0],fe=se[1],pe=function(e){if(e&&"string"===typeof e){var t=e.toString().split(".");return t&&t.length>1?t.slice(1).join("."):e}},be=function(e,t){e.map((function(e){return me[e]=t}))};be(["long","decimal","date","time","datetime"],me.integer),be(["one_to_many","json_one_to_many"],me.text),be(["many_to_many","json_many_to_many"],["in","notIn","isNull","contains","notContains"]),be(["many_to_one","one_to_one","json_many_to_one","json_one_to_one"],["=","!=","in","notIn","isNull","isNotNull"]),be(["string"],["=","!=","isNull","isNotNull","like","notLike"]);var ve=je.filter((function(e){var t=C;if(""===t&&r.fieldName&&r.allField.length>0){var n=r.allField.find((function(e){return e.name===r.fieldName}));t=(n&&n.type||"").toLowerCase()}return(me[t]||[]).includes(e.name)})),he=function(e,t){n({name:e,value:t},c)};return Object(o.useEffect)((function(){var e=r.fieldValue,t=r.allField,n=void 0===t?[]:t,a=r.fieldValue2,o=void 0===a?"":a,l=r.isRelationalValue,c=r.relatedValueModal,i=r.relatedValueFieldName,u=r.relatedElseValueModal,s=r.relatedElseValueFieldName,d=r.isShowMetaModelField,m=r.isShowElseMetaModelField;ie({allField:n,field:s,fieldName:pe(o)||s&&s.name,fieldType:s&&s.type,fieldValue:null,fieldValue2:null,operator:null,isRelationalValue:l||"none",relatedValueFieldName:i,relatedValueModal:c,relatedElseValueFieldName:s,relatedElseValueModal:u,isShow:m}),fe({allField:n,field:i,fieldName:pe(e)||i&&i.fieldName,fieldType:i&&i.type,fieldValue:null,fieldValue2:null,operator:null,isRelationalValue:l||"none",relatedValueFieldName:i,relatedValueModal:c,isShow:d}),F(l||"none"),B(d),ae(m),I(c),U(u)}),[r]),Object(De.jsxs)("div",{className:_.rules,children:[Object(De.jsx)(jt,{getMetaFields:t,isField:V,editor:c,onChange:n,value:r,expression:u,type:s,isParent:!0,setInitialField:function(){F("none")}}),Object(De.jsxs)(l.a.Fragment,{children:[Object(De.jsx)(Ye,{name:"operator",title:"Operator",options:j&&j.selectionList?je.filter((function(e){return(V&&"none"!==V?["=","!=","isNull","isNotNull"]:["=","!=","isNull","isNotNull","in","notIn"]).includes(e.name)})):V&&"none"!==V?ve.filter((function(e){return"in"!==e.name&&"notIn"!==e.name})):ve,onChange:function(e){n({name:"operator",value:e},c),F(null)},value:b,className:_.operators}),b&&!["isNull","isNotNull","isTrue","isFalse"].includes(b)&&Object(De.jsxs)($.a,{"aria-label":"radioType",name:"radioType",value:V||"none",onChange:function(e){F(e.target.value),fe({fieldValue:null}),he("fieldValue",null),ie({fieldValue2:null}),he("fieldValue2",null),!e.target.value||"in"!==b&&"notIn"!==b||(n({name:"operator",value:void 0},c),F(null)),e.target.value?(he("isRelationalValue","none"===e.target.value?null:e.target.value),he("fieldValue",null),he("fieldValue2",null),"self"===e.target.value?(I(d),U(d),he("relatedValueModal",d),he("relatedElseValueModal",d)):(I(null),U(null),ae(!1),B(!1),he("relatedValueModal",null),he("relatedElseValueModal",null))):(he("relatedValueFieldName",null),he("relatedValueModal",null),he("relatedElseValueFieldName",null),he("relatedElseValueModal",null))},children:[Object(De.jsx)("label",{className:_.valueFrom,children:"Value from"}),Object(De.jsx)(D.a,{value:"self",control:Object(De.jsx)(J.a,{className:_.radio,size:"small"}),label:"Self"}),Object(De.jsx)(D.a,{value:"context",control:Object(De.jsx)(J.a,{className:_.radio,size:"small"}),label:"Context"}),Object(De.jsx)(D.a,{value:"none",control:Object(De.jsx)(J.a,{className:_.radio,size:"small"}),label:"None"})]})]}),V&&"none"!==V&&b&&!["isNull","isNotNull","isTrue","isFalse"].includes(b)?Object(De.jsxs)(l.a.Fragment,{children:["context"===V&&Object(De.jsxs)(l.a.Fragment,{children:[Object(De.jsx)(ft,{name:"metaModal",title:"Meta Modal",placeholder:"meta modal",fetchAPI:function(){return Ve(Z(m),"metaModel")},optionLabelKey:"name",onChange:function(e){I(e),e?(fe({fieldValue:Object(bt.firstCharLowerCase)(e.name)}),he("relatedValueModal",e),he("fieldValue",Object(bt.firstCharLowerCase)(e.name))):(fe({fieldValue:null}),he("fieldValue",null))},value:R,classes:{root:_.MuiAutocompleteRoot}}),A&&"context"===V&&Object(De.jsx)(Y.a,{size:"small",onClick:function(){if(B(!1),he("isShowMetaModelField",!1),R){var e=R.name;fe({fieldValue:Object(bt.firstCharLowerCase)(e)}),he("relatedValueModal",R),he("fieldValue",Object(bt.firstCharLowerCase)(e))}},className:_.iconButton,children:Object(De.jsx)(z.a,{title:te("Remove sub field"),children:Object(De.jsx)(G.a,{color:"primary",fontSize:"small"})})})]}),(A||"self"===V)&&Object(De.jsx)(jt,{getMetaFields:function(){return"context"===V?ht(R,s):t()},editor:c,isField:V,onChange:function(e,t){var n=e.value,a=e.fieldNameValue,o=e.allField,l=e.isShow;fe({allField:o,field:n,fieldName:a,fieldType:n&&n.type,fieldValue:null,fieldValue2:null,operator:null,isRelationalValue:"none"===V?null:V,relatedValueFieldName:null,relatedValueModal:null,isShow:l,isShowMetaModelField:A}),he("isRelationalValue","none"===V?null:V),he("relatedValueFieldName",n),he("relatedValueModal",R);var c=X(s),r="context"===V&&c;he("fieldValue",a?(d&&d.id)===(R&&R.id)?c?"self.".concat(a):"".concat(Q(R&&R.name)).concat(r?"?.":re[c?"BPM":u]).concat(a).concat(n&&n.typeName&&!c?"".concat(r?"?.":re[u],"toLocalDateTime()"):""):"".concat(Q(R&&R.name)).concat(r?"?.":re[c?"BPM":u]).concat(a).concat(n&&["json-many-to-one","MANY_TO_ONE","many-to-one"].includes(n.type)&&c&&"context"===V?"".concat(r?"?.":re[u],"getTarget()"):"").concat(n&&n.typeName&&!c?"".concat(r?"?.":re[u],"toLocalDateTime()"):""):void 0)},value:de,expression:u,type:s,isParent:!0,isBPM:!0}),!A&&R&&"context"===V&&Object(De.jsx)(Y.a,{size:"small",onClick:function(){B(!0),he("isShowMetaModelField",!0)},className:_.iconButton,children:Object(De.jsx)(z.a,{title:te("Add sub field"),children:Object(De.jsx)(q.a,{className:_.icon,fontSize:"small"})})}),["between","notBetween"].includes(b)&&Object(De.jsxs)(l.a.Fragment,{children:["context"===V&&Object(De.jsxs)(l.a.Fragment,{children:[Object(De.jsx)(ft,{name:"metaModal",title:"Meta Modal Else",placeholder:"meta modal",fetchAPI:function(){return Ve(Z(m),"metaModel")},optionLabelKey:"name",onChange:function(e){U(e),e?(ie({fieldValue2:Object(bt.firstCharLowerCase)(e.name)}),he("relatedElseValueModal",e),he("fieldValue2",Object(bt.firstCharLowerCase)(e.name))):(ie({fieldValue2:null}),he("fieldValue2",null))},value:H,classes:{root:_.MuiAutocompleteRoot}}),ne&&"context"===V&&Object(De.jsx)(Y.a,{size:"small",onClick:function(){if(ae(!1),he("isShowElseMetaModelField",!1),H){var e=H.name;fe({fieldValue:Object(bt.firstCharLowerCase)(e)}),he("relatedElseValueModal",H),he("fieldValue2",Object(bt.firstCharLowerCase)(e))}},className:_.iconButton,children:Object(De.jsx)(z.a,{title:te("Remove sub field"),children:Object(De.jsx)(G.a,{className:_.icon,fontSize:"small"})})})]}),(ne||"self"===V)&&Object(De.jsx)(jt,{getMetaFields:function(){return ht(H,C)},editor:c,isField:V,onChange:function(e,t){var n=e.value,a=e.fieldNameValue,o=e.allField,l=e.isShow;ie({allField:o,field:n,fieldName:a,fieldType:n&&n.type,fieldValue:null,fieldValue2:null,operator:null,isRelationalValue:"none"===V?null:V,relatedValueFieldName:y,relatedValueModal:x,relatedElseValueFieldName:N,relatedElseValueModal:x,isShow:l,isShowMetaModelField:A,isShowElseMetaModelField:ne}),he("relatedElseValueFieldName",n),he("relatedElseValueModal",H);var c=X(s),r="context"===V&&c;he("fieldValue2",a?(d&&d.id)===(H&&H.id)?c?"self.".concat(a):"".concat(Q(R&&R.name)).concat(r?"?.":re[c?"BPM":u]).concat(a).concat(n&&n.typeName&&!c?"".concat(r?"?.":re[u],"toLocalDateTime()"):""):"".concat(Q(H&&H.name)).concat(r?"?.":re[c?"BPM":u]).concat(a).concat(n&&["json-many-to-one","MANY_TO_ONE","many-to-one"].includes(n.type)&&c&&"context"===V?"".concat(r?"?.":re[u],"getTarget()"):"").concat(n&&n.typeName&&!c?"".concat(r?"?.":re[u],"toLocalDateTime()"):""):void 0)},value:ce,expression:u,type:s,isParent:!0,isBPM:!0}),!ne&&H&&"context"===V&&Object(De.jsx)(Y.a,{size:"small",onClick:function(){ae(!0),he("isShowElseMetaModelField",!0)},className:_.iconButton,children:Object(De.jsx)(z.a,{title:te("Add sub field"),children:Object(De.jsx)(q.a,{color:"primary",fontSize:"small"})})})]})]}):b&&Object(De.jsx)(xt,{type:C,parentType:s,operator:b,onChange:function(e,t){n(e,t),he("isRelationalValue",null),he("relatedValueFieldName",null),he("relatedValueModal",null)},value:{fieldValue:v,fieldValue2:O},classes:_,editor:c,field:j}),Object(De.jsx)("div",{children:Object(De.jsx)(We,{Icon:T.a,onClick:a})})]})}function _t(e){var t=e.onAddGroup,n=e.isRemoveGroup,a=e.onRemoveGroup,c=e.onAddRule,r=e.onRemoveRule,u=e.editor,s=void 0===u?{}:u,d=e.getChildEditors,m=e.onChange,f=e.getMetaFields,p=e.isDisable,j=e.expression,v=e.type,h=e.parentMetaModal,O=e.element,g=vt(),y=Object(o.useState)(!1),F=Object(i.a)(y,2),L=F[0],R=F[1],I=s.id,S=s.rules,E=void 0===S?[]:S,A=d(s.id);return Object(o.useEffect)((function(){var e=X(v);R(e)}),[v]),Object(De.jsx)(b.a,{variant:"outlined",className:P()(g.paper,p&&g.disabled),children:Object(De.jsx)("div",{className:P()(g.rulesGroupHeader),children:Object(De.jsx)(x.a,{align:"alternate",style:{height:"100%",padding:0,margin:0},children:Object(De.jsxs)(N.a,{children:[Object(De.jsx)(_.a,{className:g.timelineOppositeContent,children:Object(De.jsx)(Ye,{name:"combinator",className:g.combinator,disableUnderline:!0,options:oe,value:s.combinator,onChange:function(e){return m({name:"combinator",value:e},s)}})}),Object(De.jsxs)(C.a,{children:[Object(De.jsx)(w.a,{variant:"outlined",style:{borderColor:"#0275d8"}}),Object(De.jsx)(M.a,{className:g.timelineConnector})]}),Object(De.jsxs)(V.a,{children:[Object(De.jsx)(We,{title:"Add Group",Icon:k.a,onClick:function(){return t(I)}}),n&&Object(De.jsx)(We,{title:"Remove Group",Icon:T.a,onClick:function(){return a(I)}}),E.map((function(e,t){return Object(De.jsx)(l.a.Fragment,{children:Object(De.jsx)(Nt,{getMetaFields:f,onRemoveRule:function(){return r(s.id,t)},onChange:function(e,n){return m(e,n,t)},editor:s,value:e,expression:j,parentType:v,isBPM:L,parentMetaModal:h,element:O})},t)})),Object(De.jsx)(We,{title:"Add Rule",Icon:k.a,onClick:function(){return c(I)}}),A.map((function(e,n){return Object(De.jsx)(l.a.Fragment,{children:Object(De.jsx)(_t,{isRemoveGroup:!0,onAddGroup:t,onRemoveGroup:a,onAddRule:c,onRemoveRule:r,getChildEditors:d,getMetaFields:f,onChange:function(e,t,n){return m(e,t,n)},editor:e,type:v,element:O,expression:j})},e.id)}))]})]})})})})}var Ct=Object(j.a)((function(e){return{Container:{display:"flex"},rulesGroupHeader:{display:"flex"},paper:{margin:e.spacing(1),padding:e.spacing(3,2)},rules:{display:"flex"},MuiAutocompleteRoot:{width:"50%",marginRight:"10px"},MuiAutocompleteRoot1:{width:"500px"},title:{flexGrow:1},disabled:{pointerEvents:"none",opacity:.5},popoverContainer:{display:"flex",flexDirection:"column",padding:e.spacing(2)},typography:{display:"flex"},popoverHeader:{display:"flex",alignItems:"center",borderBottom:"solid 1px #DDD"}}})),wt=0,Mt={id:wt,parentId:-1,combinator:"and",rules:[{}]},Vt={rules:[Mt]};var Ft=function(e){var t=e.value,n=void 0===t?Vt:t,a=e.setValue,c=e.index,r=e.element,u=e.type,j=e.queryModel,v=n.metaModals,h=n.rules,O=Object(o.useState)("GROOVY"),g=Object(i.a)(O,1)[0],y=Object(o.useState)(v),x=Object(i.a)(y,2),N=x[0],_=x[1],C=Object(o.useState)(h),w=Object(i.a)(C,2),M=w[0],V=w[1],F=Ct();function k(e){wt=(M?M.length:wt)+1,V((function(t){return[].concat(Object(m.a)(t),[{id:wt,parentId:e,combinator:"and",rules:[Object(p.a)(Object(p.a)({},Mt||{}),{},{id:wt,parentId:e})]}])}))}function L(e){V(Object(R.a)((function(t){var n=M.findIndex((function(t){return t.id===e}));t.splice(n,1)})))}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};V(Object(R.a)((function(n){var a=M.findIndex((function(t){return t.id===e}));n[a].rules=[].concat(Object(m.a)(n[a].rules),[t])})))}function I(e,t){V(Object(R.a)((function(n){n[M.findIndex((function(t){return t.id===e}))].rules.splice(t,1)})))}var S=function(e){return M.filter((function(t){return t.parentId===e}))};function E(){return A.apply(this,arguments)}function A(){return(A=Object(d.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=X(u),e.next=3,ve(N,t);case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0=[];case 6:return n=e.t0,e.abrupt("return",n.filter((function(e){return de.includes((e.type||"").toLowerCase())&&(!t||!e.json)})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(o.useEffect)((function(){a({metaModals:N,rules:M},c)}),[c,a,N,M]),Object(o.useEffect)((function(){_(v),V(h)}),[v,h]),Object(De.jsx)("div",{style:{width:"100%"},children:Object(De.jsxs)(b.a,{variant:"outlined",className:F.paper,children:[Object(De.jsx)("div",{style:{display:"flex",width:"100%",flexDirection:"column"},children:Object(De.jsx)("div",{style:{display:"flex"},children:Object(De.jsx)(ft,{name:"metaModal",title:"Meta Modal",placeholder:"meta modal",fetchAPI:function(){return Ve(Z(r),X(u)?void 0:"metaModel")},optionLabelKey:"name",onChange:function(e){_(e),V([Mt])},value:N,classes:{root:F.MuiAutocompleteRoot},readOnly:!(!j||!X(u))})})}),(M.filter((function(e){return-1===e.parentId}))||[]).map((function(e){return Object(De.jsxs)(l.a.Fragment,{children:[Object(De.jsx)(_t,{onAddGroup:k,onRemoveGroup:L,onAddRule:T,onRemoveRule:I,getChildEditors:S,getMetaFields:E,onChange:function(e,t,n){return function(e,t,n){var a=e.name,o=e.value;V(Object(R.a)((function(e){var l=M.findIndex((function(e){return e.id===t.id}));n>=0?Object.assign(e[l].rules[n]=Object(p.a)(Object(p.a)(Object(p.a)({},e[l].rules[n]),{},Object(f.a)({},a,o),"fieldName"===a?{operator:"",fieldValue:null,fieldValue2:null,isRelationalValue:null,relatedValueFieldName:null,relatedValueModal:null}:{}),"operator"===a?{fieldValue:null,fieldValue2:null,isRelationalValue:null,relatedValueFieldName:null,relatedValueModal:null}:{})):e[l][a]=o})))}(e,t,n)},editor:e,isDisable:!Boolean(N),expression:g,type:u,parentMetaModal:N,element:r}),Object(De.jsx)("br",{})]},e.id)}))]})})},kt=Object(j.a)((function(e){return{paper:{padding:e.spacing(3,2),width:"calc(100% - 40px)"},expressionContainer:{display:"flex",alignItems:"center"},root:{display:"flex",flexDirection:"column",alignItems:"flex-start",height:"calc(100% - 50px)",overflow:"auto"},expression:{display:"flex",alignItems:"flex-start"},dialog:{minWidth:300},container:{height:"100%",overflow:"hidden"},actions:{width:"100%",display:"flex",alignItems:"center",justifyContent:"flex-end"},combinator:{width:"fit-content"},timelineConnector:{backgroundColor:"#0275d8"},save:{margin:e.spacing(1),backgroundColor:"#0275d8",borderColor:"#0267bf",color:"white","&:hover":{backgroundColor:"#025aa5",borderColor:"#014682",color:"white"}},timeline:{height:"100%",width:"100%",padding:0,margin:0},timelineOppositeContent:{display:"flex",alignItems:"center",justifyContent:"flex-end",padding:0,maxWidth:"8%"},timelineItem:{width:"100%","&.MuiTimelineItem-missingOppositeContent:before":{padding:0}}}})),Lt=!1;var Tt=function(e){var t=e.parameters||{},n=t.type,a=void 0===n?"expressionBuilder":n,c=t.id,r=t.model,u=t.resultField,j=t.resultMetaField,F=t.modelFilter,L=t.queryModel,S=t.withParam,A=X(a)?"BPM":"GROOVY",B=Object(o.useState)("and"),P=Object(i.a)(B,2),$=P[0],D=P[1],J=Object(o.useState)(null),Y=Object(i.a)(J,2),z=Y[0],G=Y[1],q=Object(o.useState)(!1),K=Object(i.a)(q,2),H=K[0],U=K[1],W=Object(o.useState)([{Component:Ft}]),Z=Object(i.a)(W,2),te=Z[0],ne=Z[1],se=kt();function de(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0,l=fe[X(a)?"BPM":A],c=e.fieldName,r=e.operator,i=e.allField,u=e.fieldValue,s=e.fieldValue2,d=e.isRelationalValue,m=e.relatedValueFieldName,f=e.relatedValueModal,p=e.relatedElseValueFieldName,j=e.relatedElseValueModal,b=e.parent,v=e.nameField,h=c,O=h.split(re[X(a)?"BPM":A]).filter((function(e){return""!==e})),g=O[0],y=i.find((function(e){return e.name===g})),x=y||{},N=x.targetName,_=x.selectionList,C=x.nameField,w=y&&y.type&&y.type.toLowerCase().replaceAll("-","_"),M=y&&y.typeName,V=O.splice(1)||[];if(["many_to_many","one_to_many","json_many_to_many","json_one_to_many"].includes(w)){var F=t.match(/\$\$/g);if(F&&F.length>0){var k=V.length>=1?"".concat(g,".find{it->it.$$$$}").concat(ue.includes(r)?" != null":" == null"):"".concat(g,".").concat(V.length>0?"find":"collect","{it->it$$$$}").concat(V.length>0?ue.includes(r)?" != null":" == null":"");t=t.replace(/\$\$/g,k)}else{var L=V.length>=1?"".concat(g,".find{it->it.$$}").concat(ue.includes(r)?" != null":" == null"):"".concat(g,".").concat(V.length>0?"find":"collect","{it->it$$}").concat(V.length>0?ue.includes(r)?" != null":" == null":"");t+=L}var T=V.join(re[A]);return de({fieldName:T,operator:r,allField:i,fieldValue:u,fieldValue2:s,isRelationalValue:d,relatedValueFieldName:m,relatedValueModal:f,relatedElseValueFieldName:p,relatedElseValueModal:j,parent:O&&O[0],nameField:C||v},t,V.length>1,o)}if(["json_many_to_one","json_one_to_one","many_to_one","one_to_one"].includes(w)){var R=V.join(re[A]),I=t.match(/\$\$/g),E=V.length>=1?"".concat(g).concat(re[A]):g;return I&&I.length>0?t=t.replace(/\$\$/g,"".concat(E,"$$$$")):t+="".concat(E,"$$"),de({fieldName:R,operator:r,allField:i,fieldValue:u,fieldValue2:s,isRelationalValue:d,relatedValueFieldName:m,relatedValueModal:f,relatedElseValueFieldName:p,relatedElseValueModal:j,nameField:C||v,parent:O&&O[0]},t,V.length>1,o)}var B=["long","integer","decimal","boolean"].includes(w),P=["date","time","datetime"].includes(w);if(B&&(u||(u=0),["between","notBetween"].includes(r)&&!s&&(s=0)),d||B||"object"===typeof u||(u="'".concat(ae(u,S),"'"),s="'".concat(ae(s,S),"'")),P&&(d||(u=me(w,u),s=me(w,s)),h=M?"".concat(h,"?.toLocalDateTime()"):h),["in","notIn"].includes(r)){var $=t&&t.includes("{it->it$$}"),D=i.find((function(e){return e.name===b}))||{},J="string"===typeof e.fieldValue?e.fieldValue:e.fieldValue.map((function(e){return B?"".concat(e.nameField||e.targetName||e.fullName||e.name||e.id):e.nameField||e.targetName||e.fullName||e.name?"'".concat(e.nameField||e.targetName||e.fullName||e.name,"'"):e.id})).join(","),Y=n||V.length>=1?"":"".concat(h).concat(_?"":"".concat(re[A]).concat(v||D&&D.targetName||N||"fullName")),z="".concat("notIn"===r?"!":"","(".concat(J,")")).concat(re[A]).concat(l[r]).concat($?"All":"","(").concat(o).concat(re[A]).concat(t.replace(/\$\$/g,Y),")");return z}if(["contains","notContains"].includes(r)){var G=t&&t.includes("{it->it$$}"),q=i.find((function(e){return e.name===b}))||{},K="string"===typeof e.fieldValue?e.fieldValue:e.fieldValue&&e.fieldValue.map((function(e){return B?"".concat(e.nameField||e.targetName||e.fullName||e.name||e.id):e.nameField||e.targetName||e.fullName||e.name?"'".concat(e.nameField||e.targetName||e.fullName||e.name,"'"):e.id})).join(","),H=n||V.length>=1?"":"".concat(h).concat(_?"":"".concat(re[A]).concat(v||q&&q.targetName||N||"fullName")),U="".concat("notContains"===r?"!":"","(").concat(o).concat(re[A]).concat(t.replace(/\$\$/g,H),")").concat(re[A]).concat(l[r]).concat(G?"All":"","(").concat(K,")");return U}if(["between","notBetween"].includes(r)){var W=t.match(/it.\$\$/g);if(W&&W.length){var Q="(it.".concat(o).concat(re[A]).concat(h," >= ").concat(u," && it.").concat(o).concat(re[A]).concat(h," <= ").concat(s,")");return"notBetween"===r?"".concat(t.replace(/it.\$\$/g,"!".concat(Q))):t.replace(/it.\$\$/g,Q)}var Z=function(e){var t=e&&e.replace(/\$\$/g,h)||h;return"notBetween"===r?"!(".concat(o).concat(re[A]).concat(t," >= ").concat(u," && ").concat(o).concat(re[A]).concat(t," <= ").concat(s,")"):"(".concat(o).concat(re[A]).concat(t," >= ").concat(u," && ").concat(o).concat(re[A]).concat(t," <= ").concat(s,")")};return Z(t)}if(["isNotNull","isNull"].includes(r)){var ee="".concat(h," ").concat(l[r]),te=i.find((function(e){return e.name===b}))||{},ne=t&&t.includes("{it->it$$}");if(ne){var oe=n||V.length>=1?"":"".concat(h).concat(_?"":"".concat(re[A]).concat(te&&te.targetName||N||"fullName"));return"".concat(o).concat(re[A]).concat(t.replace(/\$\$/g,"".concat(oe," ").concat(ee)))}return"".concat(o).concat(re[A]).concat(t.replace(/\$\$/g,ee))}if(["isTrue","isFalse"].includes(r)){var le="isTrue"===r,ce="".concat(h," ").concat(l[r]," ").concat(le);return"".concat(o).concat(re[A]).concat(t.replace(/\$\$/g,ce))}if(["like","notLike"].includes(r)){var ie="".concat(h).concat(re[A]).concat(l[r],"(").concat(u,")");return"".concat("notLike"===r?"!":"").concat(o).concat(re[A]).concat(t.replace(/\$\$/g,ie))}var se=y||i.find((function(e){return e.name===b}))||{},pe="object"===typeof u&&u?"'".concat(ae(u[v]||u[N]||u.fullName||u.name||u.id||"",S),"'"):u,je="".concat("object"===typeof u&&u?"".concat(h).concat(re[A]).concat(v||se.targetName||"fullName"):h," ").concat(l[r]," ").concat(pe);return"".concat(o).concat(re[A]).concat(t.replace(/\$\$/g,je))}function me(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("date"===e){var a="'".concat(E()(t,ie.date).format("YYYY-MM-DD"),"'");return n?a:"LocalDate.parse(".concat(a,")")}if("datetime"===e)return n?"'".concat(E()(t,ie.datetime).toISOString(),"'"):"LocalDateTime.of(".concat(E()(t,ie.datetime).format("YYYY-M-D-H-m-s").split("-"),")");var o="'".concat(E()(t,ie.time).format("HH:mm:ss"),"'");return n?o:"LocalTime.parse(".concat(o,")")}function je(e,t){var n=X(a),o=n?"self":t,l=fe[n?"BPM":A];return e&&e.map((function(e){var t=e.fieldName,a=e.field,c=void 0===a?{}:a,r=e.operator,i=e.allField,u=c||{},s=u.targetName,d=u.selectionList,m=c&&c.type&&c.type.toLowerCase(),f=c&&c.typeName,p=["long","integer","decimal","boolean"].includes(m),j=["date","time","datetime"].includes(m),b=e.fieldValue,v=e.fieldValue2,h=e.isRelationalValue,O=t;if(p&&(b||(b=0),["between","notBetween"].includes(r)&&!v&&(v=0),!O||""===O))return Lt=!1,U(!0),null;var g=isNaN(b)?b:"".concat(b);if(!p&&(!b||b&&Array.isArray(b)&&b.length<=0||(!v||v&&Array.isArray(v)&&v.length<=0)&&["between","notBetween"].includes(r))&&!["isNull","isNotNull","isTrue","isFalse"].includes(r))return Lt=!1,U(!0),null;if(Lt=!0,!O)return null;if(Object(I.isEmpty)(g)&&!["isNull","isNotNull","isTrue","isFalse"].includes(r))return null;var y=O.split(re[A])[0],x=i&&i.find((function(e){return e.name===y}));if(["many_to_many","one_to_many","many_to_one","one_to_one","json_many_to_many","json_one_to_many","json_many_to_one","json_one_to_one"].includes(x&&x.type&&x.type.toLowerCase()&&x.type.toLowerCase().replaceAll("-","_")))return de(e,void 0,!1,o);h||p||"object"===typeof b||(b="'".concat(ae(b,S),"'"),v="'".concat(ae(v,S),"'")),j&&(h||(b=me(m,b),v=me(m,v)),O=f?"".concat(O,"?.toLocalDateTime()"):O);var N=n?ce:le;if(["in","notIn"].includes(r)){var _=e.fieldValue&&e.fieldValue.map((function(e){return p?"".concat(e.targetName||e.fullName||e.name):"'".concat(e.targetName||e.fullName||e.name,"'")})).filter((function(e){return""!==e})).join(",");return"".concat("notIn"===r?"!":"","(".concat(_,")")).concat(re[A]).concat(l[r],"(").concat(o).concat(re[A]).concat(O).concat(d?" ":"".concat(re[A]," ").concat(s||"fullName"),")")}if(["between","notBetween"].includes(r))return"notBetween"===r?"!(".concat(o).concat(re[A]).concat(O," >= ").concat(b," ").concat(N.and," ").concat(o).concat(re[A]).concat(O," <= ").concat(v,")"):"(".concat(o).concat(re[A]).concat(O," >= ").concat(b," ").concat(N.and," ").concat(o).concat(re[A]).concat(O," <= ").concat(v,")");if(["isNotNull","isNull"].includes(r))return"".concat(o).concat(re[A]).concat(O," ").concat(l[r]);if(["isTrue","isFalse"].includes(r)){var C="isTrue"===r;return"".concat(o).concat(re[A]).concat(O," ").concat(l[r]," ").concat(C)}if(["like","notLike"].includes(r))return"".concat("notLike"===r?"!":"").concat(o).concat(re[A]).concat(O).concat(re[A]).concat(l[r],"(").concat(b,")");var w="object"===typeof b&&b?"'".concat(ae(b[s]||b.fullName||b.name||"",S),"'"):b;return"".concat(o).concat(re[A]).concat("many_to_one"===m||"json_many_to_one"===m?"".concat(O).concat(re[A]).concat(c.targetName||"fullName"):O," ").concat(l[r]," ").concat(w)}))}function be(e){var t,n=e.jsonFieldName,a=e.parentCustomField,o=e.field,l=e.value,c=e.values,r=e.targetName,i=e.operator,u=e.map_operators,s=l;if(n&&pe.includes(a?a.type:o.type)){var d=(t=a?a.target:o.target)&&t.split(".").pop(),m="".concat(["in","notIn"].includes(i)?"(".concat(l||"",")"):["like","notLike"].includes(i)?"CONCAT('%',".concat(l,",'%')"):l||"").concat("MetaJsonRecord"===d?" and self.jsonModel = '".concat(a?a.name:o.name,"'"):""),f="(select id from ".concat(d);if(["between","notBetween"].includes(i))return f;s="".concat(f," where self").concat(c&&c.length>1?".".concat(c.slice(1).join(re[A])):"").concat(r?".".concat(r):""," ").concat(u[i]," ").concat(m,")")}return s}function ve(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=X(a),l=o?"self":t,c=fe[o?"BPM":A],r=n;return e&&e.map((function(e){var n,a=e.fieldName,i=e.field,u=void 0===i?{}:i,s=e.operator,d=e.allField,m=u||{},f=m.targetName,j=m.selectionList,b=m.model,v=m.target,h=m.jsonField,O=u&&u.type&&u.type.toLowerCase(),g=["long","integer","decimal","boolean"].includes(O),y=["date","time","datetime"].includes(O),x="com.axelor.meta.db.MetaJsonRecord"===b||"com.axelor.meta.db.MetaJsonRecord"===v||h,N=a&&a.split(re[A]);if(N&&N.length>1){var _=d&&d.find((function(e){return N&&N.find((function(t){return e.name===t&&("com.axelor.meta.db.MetaJsonRecord"===e.model||"com.axelor.meta.db.MetaJsonRecord"===e.target||e.jsonField)}))}));_&&(x=!0,n=_)}var C=x?"".concat(ee(n?Object(p.a)(Object(p.a)({},n),{},{targetName:u&&u.targetName}):u,l,a)):void 0,w=e||{},M=w.fieldValue,V=w.fieldValue2,F=w.isRelationalValue,k=w.relatedValueModal,L=void 0===k?{}:k,T=w.relatedElseValueModal,R=void 0===T?{}:T;if(g&&(M||(M=0),["between","notBetween"].includes(s)&&!V&&(V=0),!a||""===a))return Lt=!1,U(!0),null;var E=Q(L&&L.name),B=Q(R&&R.name),P=isNaN(M)?M:"".concat(M);if(!g&&(!M||M&&Array.isArray(M)&&M.length<=0||(!V||V&&Array.isArray(V)&&V.length<=0)&&["between","notBetween"].includes(s))&&!["isNull","isNotNull","isTrue","isFalse"].includes(s))return Lt=!1,U(!0),null;Lt=!0;var $=E===t||!S,D=B===t||!S;if(["isNotNull","isNull"].includes(s)||$||++r,!a)return null;if(Object(I.isEmpty)(P)&&!["isNull","isNotNull","isTrue","isFalse"].includes(s))return null;F||g||"object"===typeof M||(M="'".concat(ae(M,S),"'"),V="'".concat(ae(V,S),"'")),y&&(F||(M=me(O,M,x),V=me(O,V,x)));var J=o?ce:le;if(["in","notIn"].includes(s)){var Y=e.fieldValue&&e.fieldValue.map((function(e){return g?"".concat(e.targetName||e.fullName||e.name):"'".concat(e.targetName||e.fullName||e.name,"'")})).filter((function(e){return""!==e}));return Y=be({jsonFieldName:C,parentCustomField:n,field:u,value:Y,values:N,targetName:f,operator:s,map_operators:c}),{condition:"".concat(C||"".concat(l,".").concat(a).concat(j?"":".".concat(f||"fullName"))," ").concat(C?"IN":c[s]," ").concat($?S?C?Y:M:"(".concat(Y,")"):"?".concat(r)),values:$?void 0:[[Y]]}}if(["between","notBetween"].includes(s)){var z=$&&D?void 0:$?[V]:D?[M]:[M,V],G=be({jsonFieldName:C,parentCustomField:n,field:u,value:null,values:a&&a.split(re[A]),targetName:f,operator:s,map_operators:c});if(y&&o)return{condition:"".concat(C?"".concat(C).concat(G?" IN ":""):"".concat(l,".").concat(a)).concat(G?"".concat(G," "):"").concat(f?".".concat(f," "):"").concat("notBetween"===s?"NOT BETWEEN":"BETWEEN"," ").concat($?M:"?".concat(r)," ").concat(J.and," ").concat(D?V:"?".concat(++r)).concat(G?")":""),values:z};if(G){var q=a&&a.split(re[A]);return{condition:"(".concat(C).concat(G?" IN ":"").concat(G||"").concat("notBetween"===s?" NOT(":""," self").concat(q&&q.length>1?".".concat(q.slice(1).join(re[A])):"").concat(f?".".concat(f):""," >= ").concat($?M:"?".concat(r)," ").concat(J.and," self").concat(q&&q.length>1?".".concat(q.slice(1).join(re[A])):"").concat(f?".".concat(f):""," <= ").concat(D?V:"?".concat(++r),")").concat(G?")":"").concat("notBetween"===s?")":""),values:z}}return{condition:"".concat("notBetween"===s?"NOT ":"","(").concat(C||"".concat(l,".").concat(a)," >= ").concat($?M:"?".concat(r)," ").concat(J.and," ").concat(C||"".concat(l,".").concat(a)," <= ").concat(D?V:"?".concat(++r),")"),values:z}}if(["isNotNull","isNull"].includes(s)){var K=be({jsonFieldName:C,parentCustomField:n,field:u,value:void 0,values:N,targetName:f,operator:s,map_operators:c});return{condition:"".concat(C||"".concat(l,".").concat(a)," ").concat(C?"= ".concat(K):c[s])}}if(["isTrue","isFalse"].includes(s)){var H="isTrue"===s;return H=be({jsonFieldName:C,parentCustomField:n,field:u,value:H,values:N,targetName:f,operator:s,map_operators:c}),{condition:"".concat(C||"".concat(l,".").concat(a)," ").concat(C?"=":c[s]," ").concat($?S?M:H:"?".concat(r)),values:$?void 0:[H]}}if(["contains","notContains"].includes(s)){var W="object"===typeof M&&M?"'".concat(ae(M[u.targetName]||"",S),"'"):M;return{condition:"".concat($?S?M:W:"?".concat(r)," ").concat(c[s]," ").concat(C||"".concat(l,".").concat(a)),values:$?void 0:[W]}}var X="object"===typeof M&&M?"'".concat(ae(M[u.targetName]||"",S),"'"):M;return X=be({jsonFieldName:C,parentCustomField:n,field:u,value:X,values:N,targetName:f,operator:s,map_operators:c}),{condition:"".concat(C||"".concat(l,".").concat(["many_to_one","json_many_to_one","one_to_one","json_one_to_one"].includes(O)&&!F?"".concat(a,".").concat(u.targetName||"fullName"):a)," ").concat(C?"=":c[s]," ").concat($?["like","notLike"].includes(s)&&(!C||C&&!pe.includes(s))?"CONCAT('%',".concat(M,",'%')"):S?C?X:M:X:["like","notLike"].includes(s)&&(!C||C&&!pe.includes(s))?"CONCAT('%',?".concat(r,",'%')"):"?".concat(r)),values:$?void 0:[X]}}))}function he(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=e[0],c=l.rules,r=l.combinator,i=l.children,u=ve(c,t,o).filter((function(e){return""!==e}));if(i.length>0){var s=u&&u.map((function(e){return e&&e.values})).filter((function(e){return e}))||[],d=he(i,t,!0,s&&s.length),m=d.condition,f=d.values,p=[].concat.apply([],f);u.push({condition:m,values:p&&p.length>0?p:void 0})}var j=X(a)?ce:le,b=u&&u.map((function(e){return e&&e.condition}));return n?{condition:" ("+b.join(" "+j[r]+" ")+") ",values:u&&u.map((function(e){return e&&e.values})).filter((function(e){return e}))}:{condition:b.join(" "+j[r]+" "),values:u&&u.map((function(e){return e&&e.values})).filter((function(e){return e}))}}function Oe(e,t,n){var o=e&&e[0]||{},l=o.rules,c=o.combinator,r=o.children,i=(je(l,t)||[]).filter((function(e){return""!==e}));if(r&&r.length>0){var u=Oe(r,t,!0);i.push(u)}var s=X(a)?ce:le;return n?" ("+i.join(" "+s[c]+" ")+") ":i.join(" "+s[c]+" ")}var ge=l.a.useCallback((function(e,t){ne(Object(R.a)((function(n){n[t].value=e})))}),[]),ye=function(e,t){var n;if(r){!function(e,t){Ee.apply(this,arguments)}(r,Object(p.a)(Object(p.a)({},z||{}),{},(n={},Object(f.a)(n,u,e),Object(f.a)(n,j,t?JSON.stringify(t):t),n)));var a=window.top&&window.top.document&&window.top.document.getElementsByClassName("button-close"),o=a&&a[a.length-1];o&&o.click&&o.click()}};function xe(e,t){var n,o=[],l=[],c=te&&te.map((function(e,a){var c=e.value||{},r=c.rules,i=c.metaModals,u=i&&i.name,s=i||{},d=s.fullName,f=s.type;n=X(t)?"metaJsonModel"===f?u:d:u;var j="",b=function(e){for(var t,n={},a=[],o=e&&e.map((function(e,t){return n[e.id]=t,Object(p.a)(Object(p.a)({},e),{},{children:[]})})),l=0;l<o.length;l+=1)(t=o[l]).parentId>=0?o[n[t.parentId]]&&o[n[t.parentId]].children.push(t):a.push(t);return a}(r),v=X(t)?he(b,Q(u),void 0):Oe(b,Q(u),void 0);return l.push.apply(l,Object(m.a)(v&&((v.values||[]).filter((function(e){return Array.isArray(e)}))||[]))),i?(j+=X(t)?v&&v.condition:v,o.push({metaModalName:u,metaModalType:i.type,rules:r}),"".concat(j)):""})),r=X(a)?ce:le,i=(c.filter((function(e){return""!==e}))||[]).map((function(e){return c.length>1?"(".concat(e,")"):e})).join(" "+r[e]+" "),u=i;if(X(t)){var s="";l&&l.forEach((function(e){e&&Array.isArray(e[0])&&e[0]?s+=", (".concat(e[0],")"):(e&&Array.isArray(e)&&e.length>0&&(e=e.join(", ")),s=s+", "+e)}));var d=!L||S;u=i?"".concat(d?"(":"").concat(L?"":"".concat(S?'"'.concat(n,'"'):"".concat(n),", ")).concat(S?'" '.concat(i,' "'):" ".concat(i," ")).concat(l&&l.length>0?"".concat(s):"").concat(d?")":""):void 0}if(Lt)ye(u,{values:o,combinator:e});else if(X(a)&&!u){var f=(o&&o[0]||{}).rules;f&&f[0].rules&&0===f[0].rules.length&&ye(null,null)}}var Ne=l.a.useCallback(Object(d.a)(s.a.mark((function e(){var t,n,o,l,c,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L&&X(a)){e.next=2;break}return e.abrupt("return");case 2:return t=[],n=L.split(".")||[],o=n.length,l={criteria:[{fieldName:"name",operator:"=",value:o>1?n[o-1]:L}],operator:"and"},e.next=8,Ve(l,o>1?"metaModel":"metaJsonModel");case 8:if(c=e.sent){e.next=11;break}return e.abrupt("return");case 11:r={metaModals:c&&c[0],rules:[{id:0,parentId:-1,combinator:"and",rules:[{}]}]},t.push({Component:Ft,value:r}),ne(t);case 14:case"end":return e.stop()}}),e)}))),[L,a]);return Object(o.useEffect)((function(){function e(){return(e=Object(d.a)(s.a.mark((function e(){var t,n,a,o,l,i,u,d,m,f,p,b,v;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&c){e.next=4;break}return e.next=3,Ne();case 3:return e.abrupt("return");case 4:return e.next=6,Ie(r,c);case 6:if(t=e.sent,G(t),t){e.next=12;break}return e.next=11,Ne();case 11:return e.abrupt("return");case 12:if(n=t&&t[j],a=n&&JSON.parse(n)||{},o=a.values,l=a.combinator,i=[],o&&0!==o.length){e.next=19;break}return e.next=18,Ne();case 18:return e.abrupt("return");case 19:u=0;case 20:if(!(u<o.length)){e.next=36;break}if(d=o[u],m=d.metaModalName,f=d.metaModalType,m){e.next=25;break}return e.abrupt("return");case 25:return p={criteria:[{fieldName:"name",operator:"=",value:m}],operator:"and"},e.next=28,Ve(p,f);case 28:if(b=e.sent){e.next=31;break}return e.abrupt("return");case 31:v={metaModals:b&&b[0],rules:d.rules},i.push({Component:Ft,value:v});case 33:u++,e.next=20;break;case 36:ne(i),D(l||"and");case 38:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[a,j,c,r,u,Ne,L]),Object(De.jsxs)("div",{className:se.container,children:[Object(De.jsxs)("div",{className:se.root,children:[Object(De.jsx)(b.a,{variant:"outlined",className:se.paper,style:{display:"flex"},children:Object(De.jsx)("div",{style:{height:"100%",width:"100%"},children:Object(De.jsx)("div",{className:se.expression,style:{height:"100%",width:"100%"},children:Object(De.jsx)(x.a,{align:"alternate",className:se.timeline,children:X(a)?Object(De.jsx)(N.a,{className:se.timelineItem,children:Object(De.jsx)("div",{style:{width:"100%"},children:te&&te.map((function(e,t){var n=e.Component,o=e.value;return Object(De.jsx)("div",{className:se.expressionContainer,children:Object(De.jsx)(n,{value:o,index:t,setValue:ge,element:z&&F&&z[F],type:a,queryModel:L})},t)}))})}):Object(De.jsxs)(N.a,{style:{minHeight:"100%"},children:[Object(De.jsx)(_.a,{className:se.timelineOppositeContent,children:Object(De.jsx)(Ye,{name:"expression",options:oe,value:$,disableUnderline:!0,className:se.combinator,onChange:function(e){D(e)}})}),Object(De.jsxs)(C.a,{children:[Object(De.jsx)(w.a,{variant:"outlined",style:{borderColor:"#0275d8"}}),Object(De.jsx)(M.a,{className:se.timelineConnector})]}),Object(De.jsxs)(V.a,{children:[Object(De.jsx)(We,{title:"Add Expression",Icon:k.a,onClick:function(){ne(Object(R.a)((function(e){e.push({Component:Ft.bind({})})})))}}),Object(De.jsx)("div",{children:te&&te.map((function(e,t){var n=e.Component,o=e.value;return Object(De.jsxs)("div",{className:se.expressionContainer,children:[Object(De.jsx)(n,{value:o,index:t,setValue:ge,element:z&&F&&z[F],type:a,queryModel:L}),Object(De.jsx)(We,{Icon:T.a,onClick:function(){return function(e){ne(Object(R.a)((function(t){t.splice(e,1)})))}(t)}})]},t)}))})]})]})})})})}),Object(De.jsxs)(v.a,{open:H,onClose:function(){return U(!1)},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",classes:{paper:se.dialog},children:[Object(De.jsx)(h.a,{id:"alert-dialog-title",children:"Error"}),Object(De.jsx)(O.a,{children:Object(De.jsx)(g.a,{id:"alert-dialog-description",children:"Add all values"})}),Object(De.jsx)(y.a,{children:Object(De.jsx)(We,{title:"Ok",onClick:function(){return U(!1)}})})]})]}),Object(De.jsx)("div",{className:se.actions,children:Object(De.jsx)(We,{title:"Save",className:se.save,onClick:function(){return xe($,a)}})})]})};var Rt=function(){var e=Object(o.useState)(null),t=Object(i.a)(e,2),n=t[0],a=t[1];return Object(o.useEffect)((function(){var e=function(){for(var e,t,n,a,o,l,c,r,i,u,s,d,m,f,p,j=/[?&]type=query([^&#]*)/g,b=/[?&]id=([^&#]*)/g,v=/[?&]model=([^&#]*)/g,h=/[?&]resultField=([^&#]*)/g,O=/[?&]resultMetaField=([^&#]*)/g,g=/[?&]modelFilter=([^&#]*)/g,y=/[?&]queryModel=([^&#]*)/g,x=/[?&]withParam=([^&#]*)/g,N=window.location.href,_="expressionBuilder";j.exec(N);)_="bpmQuery";for(;i=b.exec(N);)e=i[1];for(;u=v.exec(N);)t=u[1];for(;s=h.exec(N);)n=s[1];for(;d=O.exec(N);)a=d[1];for(;r=g.exec(N);)o=r[1];for(;m=y.exec(N);)l=m[1];for(;f=x.exec(N);)c=f[1];return{type:_,id:e,model:t,resultField:n,resultMetaField:a,modelFilter:o,queryModel:l,withParam:(p=c,!!p&&!!JSON.parse(String(p).toLowerCase()))}}()||{};a(e)}),[]),Object(De.jsx)(Tt,{parameters:n})};n(166);r.a.render(Object(De.jsx)(Rt,{}),document.getElementById("root"))}},[[167,1,2]]]);
//# sourceMappingURL=main.032261b7.chunk.js.map