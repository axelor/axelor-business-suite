<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">
	
	<grid name="project-planning-grid" title="Project Plannings" model="com.axelor.apps.project.db.ProjectPlanning">
		<field name="fromDate"/>
		<field name="toDate"/>
		<field name="user"/>
		<field name="project"/>
		<field name="task"/>
		<field name="timepercent" widget="SelectProgress"/>
	</grid>
	
	<grid name="project-planning-db-grid" title="Project Plannings" model="com.axelor.apps.project.db.ProjectPlanning">
		<field name="project"/>
		<field name="task"/>
		<field name="totalPlannedHrs"/>
	</grid>
	
	<form name="project-planning-form" title="Project Planning" model="com.axelor.apps.project.db.ProjectPlanning">
		<panel>
			<field name="fromDate"/>
			<field name="toDate"/>
			<field name="user"/>
			<field name="project"/>
			<field name="task"/>
			<field name="timepercent" widget="SelectProgress"/>
			<field name="description" colSpan="12" widget="html"/>
			<panel-include view="include-project-planning-hr-form" if-module="axelor-human-resource" if="__config__.app.isApp('employee')"/>
		</panel>
	</form>
	
	<form name="project-planning-user-select-form" title="Select users"  model="com.axelor.apps.project.db.ProjectPlanning">
		<panel>
			<field name="userSet" title="Users" type="many-to-many" colSpan="12" target="com.axelor.auth.db.User" canNew="false" onSelect="action-project-planning-attrs-project-domain"/>
			<button name="showPlanning" title="Show planning" onClick="action-project-planning-show-planning" colSpan="3" />
		</panel>
	</form>
	
	<gantt name="project-planning-gantt" model="com.axelor.apps.project.db.ProjectPlanning" title="Project planning"
	 	taskStart="fromDate"  taskEnd="toDate" >
		<field name="user"/>
	</gantt>
	
	<calendar name="project-planning-calendar" model="com.axelor.apps.project.db.ProjectPlanning" 
		eventStart="fromDate" eventStop="toDate" title="Project planning" colorBy="user">
		<field name="user"/>
	</calendar>
	
	<action-attrs name="action-project-planning-attrs-project-domain">
	   <attribute name="domain" expr="eval:&quot;self.id in (${([0]+__repo__.of(Project).all().filter('self.excludePlanning = false and self.statusSelect in (1,2)').fetch().collect{it->it.membersUserSet.id}.flatten()).join(',')})&quot;" for="userSet"/>
	</action-attrs>
	
	<action-view name="action-project-planning-show-planning" title="Project planning" model="com.axelor.apps.project.db.ProjectPlanning">
		<view type="gantt" name="project-planning-gantt" />
		<view type="grid" name="project-planning-grid" />
		<view type="form" name="project-planning-form" />
		<domain>self.user.id in :_userIds</domain>
		<context name="_userIds" expr="eval:[0] + userSet.collect{it->it.id}"/>
	</action-view>
	
</object-views>
