<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">
	
	<grid name="job-application-grid" title="Job applications" model="com.axelor.apps.talent.db.JobApplication">
		<field name="lastName" />
		<field name="firstName" />
		<field name="emailAddress" />
		<field name="fixedPhone" />
		<field name="mobilePhone" />
		<field name="jobPosition" />
		<field name="statusSelect" />
	</grid>
	
	<form name="job-application-form" title="Job application" model="com.axelor.apps.talent.db.JobApplication" width="large"
		onNew="action-job-application-defaults" onLoad="action-talent-method-set-social-network-url">
		<menubar>
	        <menu title="Tools" icon="fa-wrench" showTitle="true">
	            <item title="Schedule Event" action="save,action-job-application-schedule-event" readonlyIf="id == null"/>
	        </menu>
	    </menubar>
		<panel name="mainPanel" readonlyIf="statusSelect == 3">
			<field name="statusSelect" widget="NavSelect" colSpan="12" readonly="true"/>
			<field name="hiringStage" x-order="sequence" hidden="true"/><spacer/>
			<panel colSpan="4" name="picturePanel">
				<field name="employee" showIf="statusSelect == 1" />
				<field name="picture" showTitle="false" colSpan="12" widget="Image">
					<viewer>
						<![CDATA[
				    		<img ng-show="record.picture" ng-src="{{$image('picture', 'content')}}" />
	          				<img ng-show="!record.picture" src="img/partner-default.png" />
						]]>
					</viewer>
				</field>
			</panel>
			<panel colSpan="8" name="titlePanel">
				<field name="title" colSpan="8"/><spacer/>
				<field name="firstName" onChange="action-talent-method-set-social-network-url" />
				<field name="lastName" required="true" onChange="action-talent-method-set-social-network-url"/>			
			</panel>
		</panel>
		<panel colSpan="12" name="sideBarButtonPanel" sidebar="true" hideIf="statusSelect == 1 || statusSelect == 3">
			<button name="hire" title="Hire" onClick="save,action-job-application-confirmation,action-job-application-method-hire" colSpan="12" showIf="statusSelect == 0" />
			<button name="cancel" title="Cancel" onClick="save,action-job-application-status-cancel,save" colSpan="12" icon="fa-times-circle" css="btn-danger"/>
		</panel>
		<panel name="jobOfferPanel" title="Job Offer Information" colSpan="12" sidebar="true" readonlyIf="statusSelect == 3">
			<field name="jobPosition" colSpan="6"/>
			<field name="jobPosition.statusSelect" colSpan="6"/>
			<field name="jobPosition.companyDepartment" colSpan="6"/>
			<field name="responsible" colSpan="6"/>
			<field name="jobPosition.publicationDate" colSpan="6"/>
		</panel>
		<panel name="applicationInfoPanel" title="Application Information" colSpan="12" sidebar="true" readonlyIf="statusSelect == 3">
			<field name="educationLevel" colSpan="6"/>
			<field name="referredBy" colSpan="6"/>
			<field name="talentSource" title="Source" colSpan="6"/>
			<field name="experienceSelect" colSpan="6"/>
			<field name="industrySectorSet" widget="TagSelect" colSpan="6"/>
			<field name="appreciation" widget="SelectProgress" colSpan="6"/>
			<field name="creationDate" colSpan="6"/>
			<field name="tagSkillSet" widget="TagSelect" colSpan="6" />
		</panel>
		<panel-tabs name="mainPanelTab" readonlyIf="statusSelect == 3">
			<panel name="descriptionPanel" title="Description">
				<field name="description" widget="html" colSpan="12" />
			</panel>
			<panel name="contactPanel" title="Contact" colSpan="12">
				<panel name="contactInfoPanel" title="Contact information" colSpan="12">
					<field name="mobilePhone" colSpan="4"/>
					<field name="emailAddress" canNew="true" colSpan="4"/>
					<field name="fixedPhone" colSpan="4"/>
					<field name="linkedInProfile" colSpan="4" widget="url"/>
					<label name="linkedin" title="&lt;a class='fa fa-linkedin' href='http://www.linkedin.com' target='_blank' /&gt;" colSpan="2"/>
				</panel>
				<panel name="mainAddressPanel" title="Main address" colSpan="12">
					<field name="employeeAddress" colSpan="12" form-view="address-form" grid-view="address-grid" canNew="true"/>
				</panel>
				<field name="fullName" hidden="true" />
			</panel>
			<panel name="contractPanel" title="Contract" colSpan="12">
				<field name="jobPosition.contractType" />
				<field name="expectedSalary" />
				<field name="proposedSalary" />
				<field name="availabilityFrom" />
			</panel>
			<panel-dashlet name="eventsPanel" title="Events" action="action-job-application-events" colSpan="12" />
			<panel name="reasonNotHiredPanel" title="Reason not hired">
				<field name="reasonNotHired" colSpan="12" showTitle="false"/>
			</panel>
		</panel-tabs>
		<panel-mail name="mailPanel">
		  <mail-messages limit="4" />
		  <mail-followers />
	    </panel-mail>
	</form>
	
    <action-view name="action-job-application-schedule-event" title="Schedule Event" model="com.axelor.apps.crm.db.Event">
    	<view type="form" name="event-form"/>
    	<context name="_relatedToSelect" expr="eval:'com.axelor.apps.talent.db.JobApplication'" />
    	<context name="_relatedToSelectId" expr="eval:id" />
    </action-view>
    
    <action-view name="action-job-application-events" model="com.axelor.apps.crm.db.Event" title="Events">
    	<view type="grid" name="event-grid"/>
    	<view type="form" name="event-form"/>
    	<domain>self.relatedToSelect = 'com.axelor.apps.talent.db.JobApplication' and self.relatedToSelectId = :id</domain>
    </action-view>
    
    <action-record name="action-job-application-defaults" model="com.axelor.apps.talent.db.JobApplication">
    	<field name="jobPosition" expr="eval:__repo__(JobPosition).find(_jobPositionId)"/>
    	<field name="responsible" expr="eval:__repo__(Employee).find(_responsibleId)" />
    </action-record>
    
    <action-record name="action-job-application-status-cancel" model="com.axelor.apps.talent.db.JobApplication">
    	<field name="statusSelect" expr="eval: 3"/>
    </action-record>
    
    <action-method name="action-job-application-method-hire">
    	<call class="com.axelor.apps.talent.web.JobApplicationController" method="hire"/>
    </action-method>
    
    <action-validate name="action-job-application-confirmation">
    	<alert message="A new employee form will be created. Do you confirm the creation ?"/>
    </action-validate>
    
    <action-method name="action-talent-method-set-social-network-url">
    	<call class="com.axelor.apps.talent.web.JobApplicationController" method="setSocialNetworkUrl"/>
    </action-method>
    
</object-views>
